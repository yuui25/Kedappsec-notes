<<<BEGIN>>>
# 11_tools-lab / BASICS11-06 Hop別 最小実行セット（これだけでEvidenceが揃う最小アクション定義）

## 1. 目的（本編01〜05への地続き）
本ファイルは、STEP5-12（必須Evidenceマトリクス）の `M` を、実務で「取り逃さない」ための最小実行セットを定義する。

- “ツール名” ではなく “Evidence を生む最小アクション” を定義する  
- これにより、環境差（利用可能ツール、権限、顧客運用）に左右されにくくする  
- ツールの詳細な使い方は将来 `11_tools-lab/lab-notes/` に分離し、ここは **最小アクション（何を取るか）** に集中する

---

## 2. 記載ルール（固定）
- 各 Hop で「Must Evidence」「最小アクション」「最小出力（サンプリング）」「Run Log必須項目」「失敗時フォールバック」を書く
- Claim は原則 L1→L2 の順に引き上げる（L3は合意範囲のみ）
- 取得したら即、BASICS11-02 に従い Run Log → Evidence Index/Timeline へ落とす

---

## 3. Hop別 最小実行セット

## Hop1（Recon：入口と露出の事実化）
### Must Evidence（STEP5-12）
- OSINT
- ROE（範囲/禁止事項/データ最小化：最低限）

### 最小アクション
1) 入口（URL/ホスト/サービス）を “根拠付き” で列挙する  
2) 発見ソース（どこから見つけたか）を Evidence 化する  
3) ROE の要点（禁止/非実行/サンプリング）を Evidence 化する

### 最小出力（過収集防止）
- 入口一覧：上位20〜50程度（まずは質）
- 取得日時、ソース種別（公式/CT/DNS/ポータル/資料）

### Run Log 必須
- purpose（入口選定の目的）
- claim_target：L1
- correlation_key：不要でも可（source_url などで代替）

### 失敗時フォールバック（STEP5-11）
- OSINT根拠が弱い場合：スクショ＋取得時刻を必ず残す（観測の透明性）

---

## Hop2（社員化/セッション：サインインと制御の観測）
### Must Evidence
- AUTH-LOG
- CA-POL
- （到達範囲：観測）

### 最小アクション
1) サインインログを “試験抽出” できる状態にする（Day1で確立）  
2) CA/MFA ポリシーの “現在値” を取得する（例外含む）  
3) テスト実行とログが突合できる最小セット（時刻±1h）を確保する

### 最小出力（サンプリング）
- 期間：過去24h（または該当時刻±1h）
- 件数：上位50
- フィールド（必要最小）：
  - 時刻、結果、ユーザー/主体、アプリ、MFA要求、CA評価、IP（マスク可）、相関ID

### Run Log 必須
- correlation_key（session_id / request_id があれば必須）
- safety_notes（本人操作の有無、ROE制約）

### 失敗時フォールバック
- ログが取れない：CAの現在値スクショ＋運用ヒアリング（ただしL1止まりを明記）
- CA評価が見えない：Sign-inの結果フィールドで代替、確度を下げる

---

## Hop3（AD/内部ディレクトリ探索：構造の要約）
### Must Evidence
- AD-DISC

### 最小アクション
1) OU/Group/重要サーバ候補を “要約表” として作る  
2) 要約の根拠出力（raw）を保存し、sanitized に要点だけ抜く  
3) 次Hopの宛先選定理由（なぜその高価値候補か）を 1行で残す

### 最小出力（サンプリング）
- “全部列挙”を避ける：
  - 高権限グループ候補
  - 管理系サーバ候補（名称/役割の推測は分離）
  - 委任/特権の兆候
- 個人識別子は sanitized で必ず伏せる

### Run Log 必須
- next_step_decision（宛先選定理由）
- claim_target：L1→可能ならL2（根拠出力あり）

### 失敗時フォールバック
- 権限不足で列挙が限定：限定範囲を明示し、Observation として残す
- ログ相関不可：時刻と対象の最小情報を確実に残す

---

## Hop4（材料：権限根拠と“できる理由”の確定）
### Must Evidence
- PRIV（根拠）
- （場合により）CLOUD-AUDIT（後段の根拠づけ）

### 最小アクション
1) 権限の根拠（ロール/グループ/Consent）を “1証拠” で示す  
2) その権限が次Hopを可能にする論理を 1〜2文で残す（Interpretation）

### 最小出力
- 1画面/1ログ/1出力で足りる形にする（過収集防止）

### Run Log 必須
- claim_target：L1（観測）でよい、ただし根拠は必須

### 失敗時フォールバック
- 根拠が画面で取れない：監査ログ（権限付与の事実）で代替
- それも無い：L1止まり＋不足を明示（STEP5-11テンプレ）

---

## Hop5（横展開：到達と権限変化）
### Must Evidence
- LM-LOG
- PRIV
- DFIR（可能なら）

### 最小アクション
1) 到達の事実（ログオン/セッション）をログで示す（対象時刻±15分）  
2) 権限変化（または管理権限の成立）の根拠を示す  
3) Blue 観測（検知/未検知）の根拠ログを確保する（可能範囲）

### 最小出力（サンプリング）
- 対象ホスト限定
- 時刻：±15分（必要なら±1h）
- フィールド：
  - ログオン種別、アカウント、ソース、結果、イベントID/RecordId

### Run Log 必須
- correlation_key（eventRecordId 等があれば）
- safety_notes（業務影響回避、試行回数抑制）

### 失敗時フォールバック
- サーバ側ログ無し：端末側/EDR側ログで代替し、主張強度を調整
- DFIR無し：unknown として明示し、ログ提供を REW で要求

---

## Hop6（Hybrid：同期点と波及理由）
### Must Evidence
- AADC
- （補助）CLOUD-AUDIT

### 最小アクション
1) 同期点（AADC等）の存在と役割を示す証跡を取る  
2) 同期に関連する監査ログ（権限/設定変更）を最小で押さえる

### 最小出力
- “これが同期点”を示す設定値・役割・稼働状態（機微は伏せる）
- 監査ログ：該当時刻±1h の抜粋

### Run Log 必須
- claim_target：L1〜L2（構成証跡＋ログが揃えばL2相当の説明力）

### 失敗時フォールバック
- 直接証跡が取れない：設計書/手順書＋運用ヒアリングで代替（L1止まりを明示）

---

## Hop7（Cloud：監査ログ＋API最小サンプルで確定）
### Must Evidence
- CLOUD-AUDIT
- API-SAMPLE
- PRIV（Role/Consent）

### 最小アクション
1) Entra Audit/Sign-in を “該当時刻±1h（または24h）” で抽出  
2) Role/Consent の根拠（割当/同意/スコープ）を 1証拠で示す  
3) API で **メタ情報のみ** の最小サンプルを取り、アクセス可能性を L2 で実証する

### 最小出力（サンプリング）
- 監査ログ：
  - 期間：±1h または 24h
  - フィールド：操作種別、実行者、対象、結果、相関ID
- API：
  - 件数：上位20
  - 取得：メタ情報のみ（本文/添付なし）
  - 出力：HTTP結果＋取得項目一覧（sanitized は Fact のみ）

### Run Log 必須
- correlation_key（request_id / correlation_id）
- safety_notes（本文非取得、データ最小化遵守）

### 失敗時フォールバック
- 監査ログ取得不可：現在値スクショ＋SIEM転送先の抽出で代替（L1止まりを明示）
- API不可：監査ログと権限根拠で L1 の説明に落とす（実証できない理由を明記）

---

## 4. “最小実行セット”を案件に適用する手順（開始時）
1) 対象シナリオ（A〜E）を選び、STEP5-12 の Must を抽出  
2) Hopごとに本ファイルの “最小アクション” を割り当てる  
3) Day1/Day2（STEP5-13）でログ抽出経路を確立  
4) 実行ごとに Run Log → Evidence Index → Timeline を回す  
5) Must が埋まらない場合は即 REW 起票（STEP5-14）

---

## 5. 次に作るべきもの（11_tools-lab の拡張計画）
本ファイルは「最小アクション」までで、ツールの詳細は未収録。  
次段として `lab-notes/` にツール個別手順を追加していく。

- `11_tools-lab/lab-notes/tool-<name>/...`
  - インストール
  - 安全設定（ROE/スロットリング）
  - Hop別 最小コマンド
  - raw/sanitized 例
  - 失敗と対策

---

<<<END>>>
