<<<BEGIN>>>
# STEP1-7 発見資産のリスク優先度付け（Recon Risk Prioritization）

本ドキュメントは、前工程で発見した外部公開資産を  
「どの順番で深掘りすべきか」を体系化する。  
ASM の観点では、発見そのものより **優先度付け** が最重要である。

---

## 1. 目的

資産の優先度付けを行う目的は以下である。

- どの資産から詳細調査すべきか判断する  
- 限られたリソースで最大効果を出す  
- 公開リスクが高い箇所を早期に特定する  
- 誤設定が起こりやすい領域を明確化する  

外部公開資産は量が多くなりやすいため、  
優先度付けができないと効率が著しく低下する。

---

## 2. 優先度付けの分類体系

発見された資産は大きく以下 4 軸で評価する。

---

### 2.1 露出度（Exposure）
外部からどの程度直接見えるか。

- **High:** Web / API / SSO / VPN / CDN  
- **Medium:** サブドメイン（未使用 / 放置）  
- **Low:** メール関連 / 内部指向の DNS 痕跡  

露出度が高いほど、深掘りの優先度も高くなる。

---

### 2.2 重要度（Criticality）
その資産が組織にとって重要かどうか。

- 認証基盤（/login, /auth, /sso）  
- 決済 / 個人情報システム  
- 社内向け管理画面  
- 会社の公式 Web サイト  

重要な資産は優先度が高い。

---

### 2.3 誤設定の発生しやすさ（Misconfiguration Likelihood）
クラウドや CDN は誤設定が歴史的に多い。

例：
- S3 の public-read  
- CloudFront Origin 誤設定  
- GitHub での API キー誤公開  
- CI/CD ログの公開  

誤設定の多いカテゴリは優先度を上げる。

---

### 2.4 技術的複雑性（Complexity）
複雑な構成ほど、情報漏えいや意図せぬ露出が起きやすい。

例：
- API Gateway → Lambda → 内部システム  
- 認証方式が混在（SSO + Session + OAuth）  
- CDN → 複数 Origin  

複雑性が高ければ優先順位も引き上げる。

---

## 3. 実践的な優先度付けフロー

以下は非侵襲的に行える「優先度付け手順」である。

---

### 3.1 露出度の分類（2.1 に対応）

まず、発見した資産を以下カテゴリに分類する。

High：
- Web / API / SSO / VPN  
- CDN の表面ドメイン  
- 公開ストレージ  

Medium：
- サブドメイン（存在するが応答なし）  
- 古いサーバ / 過去の環境  

Low：
- メール DNS 設定  
- 役割不明の補助ドメイン  

---

### 3.2 重要度の推定（2.2 に対応）

以下を確認する：

~~~~
https://example.com/login
https://example.com/admin
https://example.com/api/
~~~~

確認内容：
- 認証基盤の有無  
- 管理画面の存在  
- 事業上重要な機能の有無  

---

### 3.3 誤設定の起こりやすいカテゴリの優先（2.3 に対応）

以下を優先的に確認する：

- S3 / Blob / GCP Storage  
- CDN（CloudFront / Cloudflare）  
- GitHub 公開情報  
- API endpoint（特に `/v1/`, `/internal/`）  

理由：  
誤設定率が統計的に高く、実際のインシデントも多いため。

---

### 3.4 技術的複雑性の分析（2.4 に対応）

複雑な構成ほど優先度を上げる。

確認すべきポイント：

- Response ヘッダに複数のプロキシ痕跡がある  
- JS ファイルから複数用途の API が見える  
- SPA（React / Next.js 等）でバックエンドが複数存在  
- クラウド特有の多段構成のヒントがある  

例：  
~~~~
curl -I https://api.example.com
~~~~

ヘッダ例から判断：
- `X-Amz-Cf-Id` → CloudFront  
- `Server: awselb` → Load Balancer  
- `X-Powered-By: Express` → Node.js  

多段構成の痕跡は優先度を高める。

---

## 4. リスク優先順位の統合ルール

最終的な優先度は以下で決定する。

### 優先度 High
- 認証基盤 / SSO / API  
- CDN 配下の公開資産  
- ストレージ系（S3 / Blob / GCP）  
- GitHub 公開リポジトリ  

### 優先度 Medium
- 古いサーバ / 過去の環境  
- 使用技術が不明なサブドメイン  
- 特徴的な URL 構造を持つ資産  

### 優先度 Low
- メール関連  
- 内部 DNS の痕跡  
- 明らかに非利用なテストドメイン

---

## 5. 注意事項

- 深掘り前の優先度付けで「危険だから調査しない」という判断はしない  
- 優先順位は調査の順序を決めるためのものであって  
  重要度そのものの否定ではない  
- 優先度は随時更新する（新しい資産発見に応じて変動する）  

---

## 6. 参考文献

- MITRE ATT&CK: Reconnaissance  
- OWASP ASVS V1  
- NIST SP800-115  
- ISO/IEC 27002:2022  
- 各クラウドベンダー公開資料  

<<<END>>>