<<<BEGIN>>>
# 05 STEP5-01 Recon → Cloud までの攻撃チェーン統合（TLPT / WebPT 視点）

## 1. このSTEPの位置づけとゴール

### 1-1. STEP5 の役割

STEP5（05_pentest-chain）は、これまでの

- STEP1：ASM / Recon
- STEP2：認証（IAM / SSO / MFA）
- STEP3：AD / Kerberos / Lateral Movement
- STEP4：Cloud / Hybrid Identity

を **分断せずに一本の攻撃チェーンとして再構築** するフェーズです。

ここでは新しい技術を増やしません。  
代わりに、

> **「どの成果物が、次のSTEPでどう使われたか」**  
> **「なぜその攻撃判断が妥当だったか」**

を、TLPT / 実務ペンテストで **説明できる形** に整理します。

---

## 2. 攻撃チェーン全体像（俯瞰）

### 2-1. 一本の線としての全体構造

本プロジェクトで構築してきた攻撃チェーンは、以下の一本の線です。

1. **外部 Recon（STEP1）**
2. **認証突破・社員化（STEP2）**
3. **内部 AD 制圧（STEP3）**
4. **Cloud ID 侵害（STEP4）**
5. **クラウンジュエル到達（STEP5）**

重要なのは、

- 各 STEP が **単独で完結していない**
- 必ず「前STEPの成果物」を使って次へ進んでいる

という点です。

---

## 3. STEP1 → STEP2：Recon から認証突破へ

### 3-1. STEP1 の成果物

- 公開ドメイン / サブドメイン
  - `vpn.example.co.jp`
  - `portal.example.co.jp`
  - `owa.example.co.jp`
- 認証基盤の存在
  - VPN / VDI
  - SSO ポータル
  - OWA / Exchange
- 社員情報
  - メール形式
  - 部署・役職
  - 運用チーム / 管理チームの存在

### 3-2. STEP2 での利用方法

これらの Recon 情報は、

- フィッシングシナリオ設計
- パスワードスプレー対象選定
- MFA 種別の把握
- 「どこを突破すれば社員になれるか」の判断

に直接利用されました。

> **Recon は情報収集ではなく、  
> 認証突破のための設計図である**

という位置づけです。

---

## 4. STEP2 → STEP3：社員化から内部 AD へ

### 4-1. STEP2 の成果物

- 社員 A の ID / PW
- MFA 一時突破 or セッショントークン
- VPN / VDI / SSO へのログイン成功
- 社内 Windows セッションの確保

### 4-2. STEP3 での利用方法

社員 A として内部に入ったことで、

- AD / LDAP 列挙が可能になり
- Kerberos 認証が使える状態になり
- 内部横展開（SMB / RDP / WinRM）が成立

しました。

> **STEP3 は「侵入」ではなく  
> 「内部世界の構造把握と制圧」**

という役割です。

---

## 5. STEP3 内部の攻撃チェーン（要約）

STEP3 は内部的に、以下の小チェーンを持ちます。

1. AD / LDAP 列挙  
2. Kerberos 攻撃設計  
3. 資格情報窃取  
4. Lateral Movement  
5. Blue / DFIR 逆算評価  

これにより、

- 偶然ではなく
- 設計されたルートで
- 管理者・サービスアカウントに到達

できる状態を作りました。

---

## 6. STEP3 → STEP4：オンプレ AD から Cloud へ

### 6-1. STEP3 の最重要成果物

- Domain Admin 相当の権限
- サービスアカウント資格情報
- 認証基盤サーバ（AD Connect 等）への到達

### 6-2. STEP4 での利用方法

これらはそのまま、

- Azure AD Connect 侵害
- 同期アカウント悪用
- Azure AD 管理ロール獲得

に直結しました。

> **オンプレ AD を制圧すると、  
> クラウド ID に手が届く**

という現代企業特有の現実を示しています。

---

## 7. STEP4 内部のクラウド横展開（要約）

STEP4 では、以下を整理しました。

- Azure AD 管理ロールの実体
- Conditional Access / MFA の限界
- OAuth / トークン / API による横展開
- SaaS 連携を使った二次侵害

これにより、

- GUI 操作ではなく
- API 操作による
- 大規模・静的な侵害

が成立することを示しました。

---

## 8. クラウンジュエル到達の定義

本プロジェクトにおける  
**クラウンジュエル到達** とは、以下のいずれかを満たす状態です。

- 機密データ（財務 / 個人情報 / 決済情報）への継続的アクセス
- 認証基盤（ID / MFA / CA）を恒久的に制御可能
- SaaS / クラウド環境での永続的バックドア確立

重要なのは、

> **「壊したか」ではなく  
> 「いつでも壊せる状態を作ったか」**

です。

---

## 9. TLPT / 実務ペンテストでの使い方

### 9-1. TLPT で評価される観点

- 攻撃が「現実的」か
- 各段階で Blue が検知・対応できたか
- 防御投資が本当に効いているか

本 STEP5-01 の統合チェーンは、

- 単発脆弱性ではなく
- **組織全体の耐性**

を評価するための土台になります。

---

## 10. 次の STEP（5-02）への接続

次の **STEP5-02** では、

- 本 STEP5-01 の攻撃チェーンを
- **複数の具体シナリオ（ユースケース）** に分解します。

例：

- Web 脆弱性起点チェーン
- フィッシング起点チェーン
- 内部不正想定チェーン

など、**現場でそのまま使える攻撃シナリオ** に落とし込みます。

---

## 11. まとめ

- STEP1〜4 は、単独では意味を持たない
- STEP5 で初めて「攻撃チェーン」として価値を持つ
- 本 STEP5-01 は、
  - Recon → Cloud を
  - 一本の線として説明可能にした
- 次の STEP5-02 で、これを **実務シナリオ** に変換する

<<<END>>>