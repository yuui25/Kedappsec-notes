<<<BEGIN>>>
# 05 STEP5-09 Evidence Index（標準カラム）＋Timeline（標準カラム）＋Report貼り付け要約テンプレ

## 1. このSTEPの目的（STEP5-08 を“記録データ化”して省力化する）

STEP5-08 では、侵入起点別 Runbook と記録フォームにより「作業が進んでから証拠不足に気づく」問題を潰した。  
本 STEP5-09 では、記録フォームで集めた情報を **機械的に整形できる構造** に落とし込む。

- Evidence Index：証拠を **検索・集計・本文参照** できる「台帳」
- Timeline：Hop を跨いだ時系列を **相関・説明** できる「イベント列」
- 要約テンプレ：Evidence/Timeline から **Report の文章** をブレずに生成する枠

ゴールは、

> Evidence が “ある/ない” ではなく、  
> Evidence が “使える/説明できる” 状態で運用できること

である。

---

## 2. Evidence Index（台帳）の標準スキーマ

### 2-1. Evidence Index の基本思想（1 Evidence = 1 行）

- Evidence ID（E-###）を主キーとして 1 行に集約する
- `raw` と `sanitized` の対応を同一行で管理する
- Hop / Finding / Claim レベル（L1/L2/L3）を必ず持たせ、Report への貼り付けを容易にする

---

### 2-2. 標準カラム定義（必須 / 推奨）

#### 必須（MUST）

- `evidence_id`：`E-###`
- `title`：短い説明（検索しやすい名詞句）
- `hop`：`Hop1`〜`HopN`
- `claim_level`：`L1` / `L2` / `L3`
- `collected_at_iso_jst`：`YYYY-MM-DDTHH:MM:SS+09:00`
- `source_type`：`onprem` / `cloud` / `saas` / `osint` / `other`
- `source_name`：取得元（ホスト名/サービス名/画面名）
- `actor`：実行主体（例：`user:employeeA` / `role:GlobalAdmin` / `tester:redteam` など）
- `artifact_type`：`log` / `command_output` / `screenshot` / `file` / `note`
- `path_raw`：`evidence/.../raw/...`
- `path_sanitized`：`evidence/.../sanitized/...`（無い場合は `-`）
- `sha256_raw`：`sha256:...`
- `sha256_sanitized`：`sha256:...`（無い場合は `-`）
- `confidentiality`：`public` / `internal` / `confidential` / `restricted`
- `pii_flag`：`yes` / `no`（個人情報を含む可能性）
- `secrets_flag`：`yes` / `no`（鍵/トークン等の秘密情報を含む可能性）

#### 推奨（SHOULD）

- `finding_id`：`F-###`（未確定なら `TBD`）
- `scenario`：`A`〜`E`（STEP5-02 の侵入起点）
- `summary_1line`：Report に貼れる 1 行要約（後述テンプレで生成）
- `masking_status`：`none` / `partial` / `full`
- `review_status`：`draft` / `reviewed` / `final`
- `retention`：`30d` / `90d` / `1y` / `contract`（契約・規程に合わせて）
- `notes`：補足（最小限）

---

### 2-3. 値の制約（バリデーションルール）

Evidence Index の品質を担保するため、以下を「入力制約」として固定する。

- `evidence_id`：`^E-\d{3}$`
- `hop`：`^Hop[1-9]\d*$`
- `claim_level`：`L1|L2|L3`
- `artifact_type`：固定リストのみ
- `collected_at_iso_jst`：ISO 形式 + JST オフセット必須
- `path_*`：相対パスのみ（環境依存パス禁止）
- `sha256_*`：`sha256:` プレフィックス必須

---

### 2-4. Evidence Index の最小例（Markdown 表）

（実案件では Excel を推奨。Markdown はレビュー用途。）

| evidence_id | title | hop | claim_level | collected_at_iso_jst | source_type | source_name | actor | artifact_type | path_raw | path_sanitized | sha256_raw | sha256_sanitized | confidentiality | pii_flag | secrets_flag | finding_id | scenario | summary_1line | review_status |
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
| E-060 | App 権限変更の監査ログ（抜粋） | Hop7 | L1 | 2025-11-19T14:44:00+09:00 | cloud | Entra Audit Log | role:AppAdmin | log | evidence/hop7_cloud_api/raw/e060.json | evidence/hop7_cloud_api/sanitized/e060.md | sha256:... | sha256:... | restricted | no | yes | F-003 | A | 高権限アプリ権限変更が監査ログ上で観測された | reviewed |

---

## 3. Timeline（時系列）の標準スキーマ

### 3-1. Timeline の基本思想（Hop と Evidence を結び、相関に耐える）

Timeline は「出来事の列」であり、Evidence は「出来事の根拠」である。  
必ず Timeline の行に Evidence ID を紐付け、Report から辿れるようにする。

---

### 3-2. 標準カラム定義（CSV 推奨）

#### 必須（MUST）

- `event_id`：`T-####`（Timeline ID）
- `time_iso_jst`：`YYYY-MM-DDTHH:MM:SS+09:00`
- `scenario`：`A`〜`E`
- `hop`：`Hop1`〜
- `event_type`：`recon` / `signin` / `discovery` / `priv_change` / `lateral` / `config_change` / `api_access` / `collection` / `note`
- `actor`：実行主体（Evidence Index と同形式）
- `target`：対象（ホスト/サービス/リソース）
- `result`：`success` / `fail` / `observed`
- `claim_level`：`L1|L2|L3`
- `evidence_ids`：`E-010;E-011` のように `;` 区切り
- `narrative_1line`：Report に貼る 1 行叙述（後述テンプレで生成）

#### 推奨（SHOULD）

- `src`：接続元（端末/ネットワーク/クラウド起点）
- `dst`：接続先（ホスト/サービス）
- `correlation_key`：相関キー（例：セッションID、リクエストID、ログの eventRecordId など “存在する場合のみ”）
- `blue_observation`：`detected` / `not_detected` / `unknown`
- `notes`：補足

---

### 3-3. Timeline の最小例（CSV イメージ）

~~~~
event_id,time_iso_jst,scenario,hop,event_type,actor,target,result,claim_level,evidence_ids,narrative_1line,blue_observation
T-0060,2025-11-19T14:44:00+09:00,A,Hop7,config_change,role:AppAdmin,EntraID:AppPermission,observed,L1,E-060,"高権限アプリ権限の変更が監査ログ上で観測された（E-060）",unknown
T-0070,2025-11-20T10:05:00+09:00,A,Hop7,api_access,tester:redteam,GraphAPI:SharePointList,success,L2,E-070,"API 経由で対象リソースへのアクセス可能性を最小限のサンプリングで実証した（E-070）",not_detected
~~~~

---

## 4. Evidence → Report 文章への「要約テンプレ」

### 4-1. なぜ要約テンプレが必要か

- 人によって文章の粒度・言い回しがブレる
- 推測と事実が混ざる
- Claim レベル（L1/L2/L3）が曖昧になる

これを防ぐため、Evidence Index / Timeline の `summary_1line` と `narrative_1line` は、以下テンプレで作る。

---

### 4-2. Evidence 1 行要約テンプレ（summary_1line）

**テンプレ（固定）**

- L1（Observed）  
  `"{何が} が {どこで} により観測された（{evidence_id}）"`
- L2（Demonstrated）  
  `"{何が} を {どの範囲で（最小限）} 実証した（{evidence_id}）"`
- L3（Executed）  
  `"{何を} を {スコープ合意内で} 実行し {結果} を得た（{evidence_id}）"`

**禁止（混入しやすい曖昧表現）**

- 「おそらく」「可能性が高い」を summary_1line に入れない  
  → 推測は `notes` または Findings の「影響」節へ分離する。

---

### 4-3. Hop 叙述 1 行テンプレ（narrative_1line）

**テンプレ（固定）**

`"Hop{n} で {目的} を達成し、{次Hopに進める状態} を得た（{evidence_ids}）"`

例（形式）：

- `Hop7 で API 経由のアクセス可能性を最小限で実証し、クラウンジュエル到達の根拠を得た（E-070;E-071）`

---

### 4-4. Report に貼る “Hop 詳細” テンプレ（短文ブロック）

以下を Hop ごとに統一する（本文の 3-3 Hop 詳細へ貼る）。

- 目的：`{目的}`
- 実施内容（要約）：`{narrative_1line}`
- 取得できた権限 / 情報：`{要点（名詞句）}`
- 影響（次Hopが可能になった理由）：`{次Hopに繋がる一文}`
- Claim レベル：`{L1/L2/L3}`
- Evidence：`{E-###;E-###}`

---

### 4-5. Findings（発見事項）に貼る “根拠文” テンプレ

**テンプレ（固定）**

- 事実（Fact）：`Evidence Index の summary_1line を列挙（L1/L2/L3 を混在させない）`
- 解釈（Interpretation）：`事実から言える範囲で1〜2文（推測はここに限定）`
- 影響（Impact）：`業務/統制へ翻訳（STEP5-03 の言い換え）`
- 対策（Recommendation）：`短期/中期/長期`

---

## 5. “台帳”と“本文”の結線ルール（破綻防止）

### 5-1. Report の各参照点は Evidence Index に必ず戻れる

- Report 内の Evidence 記載は **Evidence ID のみ**
- Evidence の内容は Evidence Pack（raw/sanitized）にのみ存在する
- “Report だけで完結”を狙わず、**監査可能性** を優先する

### 5-2. Timeline と Evidence Index の整合（最低条件）

- Timeline の `evidence_ids` は Evidence Index に必ず存在する
- Evidence Index の `hop` と Timeline の `hop` は一致する
- Claim レベルは一致する（Evidence 側 L2 なのに Timeline 側 L1 などは禁止）

---

## 6. 次のSTEP（5-10）への接続

次の **STEP5-10** では、STEP5-09 のスキーマを前提に、

- Evidence Index / Timeline から
  - Executive Summary の「上位リスク」候補
  - Hop 概要（1枚）
  - Findings の Fact（根拠文）
を **半自動で組み立てるための生成ルール（文章部品カタログ）**

を整備し、Report 作成をさらに省力化する。

<<<END>>>
