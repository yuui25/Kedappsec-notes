<<<BEGIN>>>
# 05 STEP5-07 Hop別 必須Evidenceチェックリストと運用ルール（TLPT / ペネトレ共通）

## 1. このSTEPの目的（STEP5-05/06の“運用化”）

本 STEP5-07 は、STEP5-05（テンプレ）と STEP5-06（完成例）を前提に、

- Hop ごとに **最低限そろえるべき Evidence セット**
- TLPT と通常ペンテストでの **Evidence 粒度の切り替え**
- 「到達可能性の証明」と「実行」を **報告書上で混同しない** 書き分けルール
- Evidence Pack の **命名・保管・整合性（ハッシュ）運用**

を固定し、案件ごとに迷いなく回せる状態にする。

---

## 2. Evidence Pack 運用ルール（共通ルール）

### 2-1. Evidence ID 命名規則

- Evidence ID は `E-###`（3桁ゼロ埋め）で一意
- 例：`E-010`, `E-011` …
- Hop / Finding の参照は「本文側」では `E-010〜E-012` のように範囲記載可
- Evidence Pack 側（Index）では必ず 1 行 1 Evidence（粒度を保つ）

### 2-2. フォルダ構造（推奨）

~~~~
evidence/
  hop1_recon/
    sanitized/
    raw/
  hop2_session/
    sanitized/
    raw/
  hop3_ad_discovery/
    sanitized/
    raw/
  hop4_cred_material/
    sanitized/
    raw/
  hop5_lateral_movement/
    sanitized/
    raw/
  hop6_hybrid_identity/
    sanitized/
    raw/
  hop7_cloud_api/
    sanitized/
    raw/
  index/
    evidence-index.xlsx (or .md)
    hash-manifest.txt
  chain/
    attack-narrative-timeline.csv
~~~~

- `raw/`：完全版（アクセス制御必須）
- `sanitized/`：本文引用用（マスキング済み）
- `hash-manifest.txt`：Evidence のハッシュ値一覧（改ざん検知）

### 2-3. Evidence の最低メタ要件（必須）

Evidence 1 件ごとに以下を必ず持つ。

- 取得日時（JST, ISO 推奨：`YYYY-MM-DDTHH:MM:SS+09:00`）
- 取得元（ホスト / サービス / 画面名）
- 実行主体（アカウント、または“検証用”と明記）
- 形式（ログ / 出力 / 画面 / ファイル）
- 保存場所（相対パス）
- ハッシュ（SHA-256 推奨）

---

## 3. Hop別 必須Evidenceチェックリスト（最小セット）

本チェックリストは、STEP5-06 の Hop1〜Hop7 を基準にしている。  
Hop 数が増減しても「同種 Hop に同じ必須要件」を適用する。

各 Hop で Evidence を揃える目的は一貫している：

- **主張（Claim）** を裏付ける
- **再現性（Reproducibility）** を担保する
- **監査性（Accountability）** を満たす

---

### 3-1. Hop1（Recon / OSINT）

#### 必須 Evidence（Minimum）

- [ ] 対象入口（例：SSO/VPN/OWA）の一覧（URL/ホスト名、取得日時、ソース種別）
- [ ] 対象組織情報（メール形式・部署情報等）の根拠（公開情報の参照メモ）
- [ ] Recon 結果から「侵入起点を選んだ判断理由」メモ（短文で可）

#### 推奨 Evidence（Nice-to-have）

- [ ] 入口ごとの想定リスク（認証方式、MFA有無、露出範囲）
- [ ] 対象のスコープ適合性チェック（Out of Scope に触れていない根拠）

---

### 3-2. Hop2（社員化 / セッション確保：SSO/VPN/VDI）

#### 必須 Evidence（Minimum）

- [ ] サインイン証跡（IdP 側のサインインログ、または VPN/VDI 側ログ）
- [ ] 付与されたセッションの範囲（どのネットワーク/どのアプリに到達したかの証跡）
- [ ] 取得した権限レベル（一般ユーザー等）の根拠（ロール/グループの確認結果）

#### 推奨 Evidence（Nice-to-have）

- [ ] Conditional Access 評価結果 shown（適用ポリシーの一覧/要約）
- [ ] 「本人操作の要否」（MFA要求・追加要素）の観測メモ

---

### 3-3. Hop3（AD / ディレクトリ探索・列挙：Discovery）

#### 必須 Evidence（Minimum）

- [ ] AD 構造・主要 OU/グループの要約（攻撃用組織図の材料になる）
- [ ] 高価値ターゲット候補（DC/Jump/Connect/認証基盤/重要サーバ）の一覧（示せる範囲で）
- [ ] その結果に基づく「次 Hop の宛先選定理由」

#### 推奨 Evidence（Nice-to-have）

- [ ] DC 側ログ（ディレクトリアクセスや Kerberos 関連の該当期間抽出）
- [ ] Blue 観測（検知有無のコメント：リアルタイム検知の有無を確認できた場合）

※実行コマンド等の詳細は raw 側に格納し、本文は要約で足りる。

---

### 3-4. Hop4（資格情報・材料の獲得：Credential Material）

#### 必須 Evidence（Minimum）

- [ ] 追加の前進材料が得られた事実（例：接続先情報、アカウント存在、経路確証）
- [ ] 材料が「どの Hop を可能にしたか」の紐付け（Hop5/6 への接続）
- [ ] 機微情報の取り扱い（マスキング実施、raw保管先、本文非掲載の理由）

#### 推奨 Evidence（Nice-to-have）

- [ ] EDR/端末ログ上の観測（高優先アラートの有無、プロセス可視性）
- [ ] 代替経路の検討メモ（LSASS等の高検知行為を避けた判断理由）

---

### 3-5. Hop5（Lateral Movement：管理端末/サーバへの横展開）

#### 必須 Evidence（Minimum）

- [ ] 到達したホスト（管理端末/ジャンプ等）の証跡（ログオン成功・セッション確保の証拠）
- [ ] そのホストで得られた「権限の変化」（一般→特権の根拠）
- [ ] 横展開が「業務経路に紛れうる」または「検知されうる」根拠（ログは残る等）

#### 推奨 Evidence（Nice-to-have）

- [ ] 端末/サーバのイベントログ抜粋（ログオン種別、関連イベント）
- [ ] ネットワーク観測（管理セグメント到達、通信フローの要約）
- [ ] Blue 側の検知有無（相関ルール未整備など“評価所見”に直結）

---

### 3-6. Hop6（Hybrid Identity：Azure AD Connect / 同期経路）

#### 必須 Evidence（Minimum）

- [ ] “これが Connect/同期の接続点である”根拠（構成/役割の証跡）
- [ ] 同期経路がクラウド権限へ波及する理由（ロール/権限/同期対象の要約）
- [ ] クラウド側での監査ログ上の事実（管理操作の痕跡、または到達可能性の根拠）

#### 推奨 Evidence（Nice-to-have）

- [ ] 同期関連アカウントの棚卸し結果（名称・役割・変更頻度の観測）
- [ ] Connect サーバへのアクセス統制（誰が入れるか、運用実態メモ）

---

### 3-7. Hop7（クラウド内部横展開：OAuth / Token / API / SaaS）

#### 必須 Evidence（Minimum）

- [ ] 監査ログ（Audit/Sign-in）上の事実（アプリ権限変更/同意/サインイン等）
- [ ] API 経由で「到達可能」である証明（最小限サンプリングの結果）
- [ ] データ最小化の証跡（本文はメタ情報のみ、raw は厳格保管、取得範囲は合意内）

#### 推奨 Evidence（Nice-to-have）

- [ ] “対話ログインではなく API 経路”で成立したことの説明（CA/MFAの効き所整理）
- [ ] SaaS 連携がある場合：Azure AD 側の変更が SaaS 権限に波及する根拠

---

## 4. TLPT と通常ペンテストでの Evidence 粒度切替ルール

### 4-1. 通常ペンテスト（一般的な目的）

- 目的：脆弱性/設定不備の特定と是正
- Evidence の中心：Finding の再現性
- チェーンは「必要な範囲で」示す

#### 必須寄りの Evidence

- Finding 単位の再現証跡（要求/応答、設定画面、ログ、影響の証拠）
- 影響説明の根拠（アクセス範囲、権限の根拠）

### 4-2. TLPT（Threat Led：目的が異なる）

- 目的：現実的脅威シナリオで、検知・対応・統制が機能するか評価
- Evidence の中心：Hop 連鎖（線）と検知評価（Blue）
- 実データ取得は原則避け、**到達可能性の証明** を重視

#### TLPT で増える Evidence

- Hop のタイムライン（時刻・相関用）
- Blue 観測ログ（検知できた/できない根拠）
- クラウド監査ログ（管理操作・アプリ権限・同意など）
- “実行しないが可能”を支える根拠（設計上成立する事実）

---

## 5. 「到達可能性の証明」と「実行」を混同しない報告ルール

### 5-1. Claim レベル（本文で必ず明記）

本文の主張（Claim）は、以下のレベルで表現を統一する。

- **L1 Observed（観測）**：ログ/設定/構成から成立が観測できた（実行はしていない）
- **L2 Demonstrated（実証）**：最小限の検証で成立を示した（サンプリング）
- **L3 Executed（実行）**：スコープ内で実行し、結果が得られた（強い証拠）

例（書き分け）：

- L1：`当該ロールにより Admin Consent が可能であることを監査ログ/設定から観測（E-060）`
- L2：`API でメタ情報のみ取得し、アクセス可能性を実証（E-071）`
- L3：`スコープ合意の範囲で操作を実行し結果を取得（E-072）`

### 5-2. “実行しない”場合の書き方テンプレ

- 実行しなかった理由（ROE/安全/業務影響）
- それでも成立が言える根拠（ログ・設定・権限・到達経路）
- 実行した場合の想定影響（影響評価）

この 3 点を 1 セットで書き、推測と事実を分離する。

---

## 6. Evidence Pack 品質ゲート（提出前チェック）

提出前に、以下を満たすまで Evidence Pack を “未完成” と扱う。

- [ ] すべての Evidence にメタ要件（日時/取得元/主体/形式/保存先/ハッシュ）がある
- [ ] Report 本文の主張（Hop/Findings）に **Evidence ID が紐付く**
- [ ] タイムライン（JST）で並べたとき矛盾がない
- [ ] `raw` と `sanitized` の対応が取れている（同一 Evidence と分かる）
- [ ] 機微情報（個人情報/秘密鍵/トークン等）の本文露出がない
- [ ] データ最小化（必要最小限サンプリング）を説明できる

---

## 7. 次のSTEP（5-08）への接続

次の **STEP5-08** では、STEP5-07 のチェックリストを前提に、

- 侵入起点別（STEP5-02 の A〜E）に
  - 「Hop テンプレ（最小 Hop 構成）」
  - 「各 Hop の必須 Evidence を自動で埋めるための“記録フォーム”」
を作り、案件開始から記録が破綻しない **運用Runbook化** を行う。

<<<END>>>
