# ASVS L3（v5.0）Webペネトレーション実務チェックリスト（L3特化）
対象：**ASVS 5.0.0 L3（高保証）**。L1/L2の要件を前提に、**L3で強化・追加される外形確認可能な観点**だけを本編に収録。金融・医療・公共など**高リスク/高価値**なアプリ向け。ブラックボックスに加え、**必要最小限の設計情報・アカウント**の提供を受けた**グレーボックス**前提で、設計/実装/運用を**深く**検証する。  
要件番号は **ASVS：v5.0.0-<chapter.section.requirement>** で併記。表記・粒度は *asvs-l1-web-pentest-guide.md* に統一。

---

## 0. 実施前提（L1/L2と同一）
- **ステージング限定・非破壊**（DoS/総当たりは合意範囲で最小限）。
- **証跡**：日時、HTTP要求/応答（ヘッダ含む）、画面キャプチャ、再現手順。
- **範囲合意**：対象機能/API・ロール・IdP/AS/RS（該当時）・負荷上限。

---

## 1. ブラウザ保護ヘッダ（L3での厳格運用）
- **CSPの厳格化**：`object-src 'none'` と `base-uri 'none'` を満たし、**インライン実行は nonce/hash のみ**。主要画面すべてで一貫適用。  
  - 手順：全代表画面の CSP を確認（UI種別ごと）。`unsafe-inline`/`unsafe-eval` が不要に許可されていないこと。  
  - 成果物：レスポンスヘッダ一覧、違反時ブロック挙動。  
  - ASVS：v5.0.0-3.4.3
- **クリックジャッキング対策**：`frame-ancestors`（CSP）で**埋め込み許可元を最小化**。  
  - ASVS：v5.0.0-3.4.6
- **補完ヘッダ**：`X-Content-Type-Options: nosniff` / `Referrer-Policy` の全ページ適用を再確認。  
  - ASVS：v5.0.0-3.4.4 / v5.0.0-3.4.5

> 注：L3では**網羅性と誤許可ゼロ**が求められるためサンプルではなく**全主要パスの採取**を推奨。

---

## 2. 認証（L3の強化点）
- **SMS/電話OTPを選択肢に含めない**（PSTN要素の提供不可を確認）。  
  - 手順：ログイン/MFA設定/回復フローで**電話/SMSが提供されていない**ことをUIで確認。  
  - ASVS：v5.0.0-6.6.1
- **IdP連携の強度/最近性**（必要機能で `acr`/`amr`/`auth_time` を踏まえた**強い認証の要求**を外形確認）。  
  - 手順：高リスク操作で**強い認証**が必須になる設計（IdP主張の活用）がUI/APIの挙動に反映されているか。  
  - ASVS：v5.0.0-6.8.4（詳細実装は付録へ）
- **MFA・回復フローの堅牢化**：既存MFAを**バイパスできない**。  
  - ASVS：v5.0.0-6.4.3（L3でも必須水準として再確認）

---

## 3. セッション管理（高保証向けの外形確認）
- **敏感操作の再認証・セッション強制終了 UI**（他端末の失効や一括サインアウト）。  
  - ASVS：v5.0.0-7.4.3 / v5.0.0-7.5.2
- **認証要素変更時の全セッション終了オプション**。  
  - ASVS：v5.0.0-7.4.3
- **ログアウト動線の常時提示**。  
  - ASVS：v5.0.0-7.4.4

---

## 4. OAuth/OIDC（L3追加・強化点）
- **RT再利用対策の強化**：**送信者拘束（sender‑constrained）**のリフレッシュトークン（DPoP もしくは mTLS）を優先採用。  
  - 外形確認：DPoP ヘッダの有無／mTLS のクライアント認証要件／RTローテーションのみ運用の排他。  
  - ASVS：v5.0.0-10.4.5（※実装/構成の詳細は付録へ）
- **クライアント/RS 側の強化**：`state`/`nonce`/PKCE の**強固な束縛**、RS 側の **aud/scope/authorization_details** に基づく認可。  
  - ASVS：v5.0.0-10.1.2 / v5.0.0-10.2.1 / v5.0.0-10.3.1 / v5.0.0-10.3.2 / v5.0.0-10.3.4
- **OP/同意管理**：Implicit禁止、`response_mode` の制限、バックチャネルログアウトの安全性。  
  - ASVS：v5.0.0-10.6.1 / v5.0.0-10.6.2 / v5.0.0-10.5.5

---

## 5. 自己完結トークン（JWT等）の厳格化（受入側で外形確認）
- **トークン用途の誤用防止**（ID Token を認可判断に使用しない）。  
  - ASVS：v5.0.0-9.2.2
- **Audience 制約の厳格検証**（`aud` が当該サービスのみ）。  
  - ASVS：v5.0.0-9.2.3

> 署名アルゴリズム許可リスト／鍵供給元／有効期間検証などの**発行/検証内部**は付録Bで対象外化。

---

## 6. クライアント保護・構成（L3での徹底）
- **公開面の締め付け**：ディレクトリリスティング無効／HTTP TRACE 無効／内部ドキュメント・監視UIの**非公開**。  
  - ASVS：v5.0.0-13.4.3 / v5.0.0-13.4.4 / v5.0.0-13.4.5
- **機微データのブラウザ保持禁止**：`Cache-Control: no-store`、`localStorage/IndexedDB` に機微を置かない。  
  - ASVS：v5.0.0-14.3.2 / v5.0.0-14.3.3

---

## 付録A：短時間実施の推奨順（L3フォーカス・3–6h）
1. **CSP/クリックジャッキング**（全主要画面での厳格適用の確認）  
2. **MFA/認証強度**（SMS不可、回復フローのバイパス無）  
3. **OAuth/OIDC**（DPoP/mTLS の採否、PKCE/nonce/state の束縛）  
4. **JWT受入**（用途誤用なし／`aud`厳格一致）  
5. **公開面**（ディレクトリリスティング/TRACE/内部ドキュメントの非公開、ブラウザキャッシュ抑止）

---

## 付録B：**WEBペネトレーションテスト範囲から対象外**（ASVS 5.0.0 L3）

### V1 エンコード/サニタイズ・低レイヤ欠陥
- ASVS：v5.0.0-1.3.1：**ライブラリ/実装選定の確認が必要**のためWEBペネトレーションテスト範囲から対象外。  
- ASVS：v5.0.0-1.3.2：**内部実装（動的コード実行）の確認が必要**のためWEBペネトレーションテスト範囲から対象外。  
- ASVS：v5.0.0-1.3.8 / 1.3.9 / 1.3.10 / 1.3.11：**内部処理依存**のためWEBペネトレーションテスト範囲から対象外。  
- ASVS：v5.0.0-1.4.1〜1.4.3：**言語/メモリ安全のコードレビューが必要**のためWEBペネトレーションテスト範囲から対象外。

### V2 文書/運用中心
- ASVS：v5.0.0-2.1.2 / 2.1.3：**文書化の確認事項**のためWEBペネトレーションテスト範囲から対象外。  
- ASVS：v5.0.0-2.4.1：**アンチオートメーションの運用保証**のためWEBペネトレーションテスト範囲から対象外。

### V5 ファイル
- ASVS：v5.0.0-5.1.1：**許可拡張/最大サイズの文書確認**のためWEBペネトレーションテスト範囲から対象外。  
- ASVS：v5.0.0-5.4.3：**AV スキャン運用の保証**のためWEBペネトレーションテスト範囲から対象外。

### V6 認証（内部実装/ポリシー）
- ASVS：v5.0.0-6.5.2〜6.5.5：**コード/保管/寿命パラメータの内部確認が必要**のためWEBペネトレーションテスト範囲から対象外。  
- ASVS：v5.0.0-6.8.4：**IdP 主張の厳密検証は連携設計の確認が必要**のためWEBペネトレーションテスト範囲から対象外。

### V7 セッション（運用/設計項目）
- ASVS：v5.0.0-7.1.2 / 7.1.3 / 7.6.1 / 7.6.2：**並行セッション/SSO協調/寿命整合は文書/連携設計の確認**のためWEBペネトレーションテスト範囲から対象外。  
- ASVS：v5.0.0-7.4.5：**管理UI/権限依存**のためWEBペネトレーションテスト範囲から対象外。

### V8 認可（ポリシー文書）
- ASVS：v5.0.0-8.1.2：**フィールド権限制御の文書確認**のためWEBペネトレーションテスト範囲から対象外。

### V9 自己完結トークン（発行/鍵管理）
- ASVS：v5.0.0-9.1.1〜9.1.3 / 9.2.1：**署名アルゴリズム許可/鍵供給/有効期間の内部実装確認**のためWEBペネトレーションテスト範囲から対象外。

### V10 OAuth/OIDC（サーバ側の詳細実装）
- ASVS：v5.0.0-10.4.5：**mTLS/DPoP の構成保証はサーバ実装確認が必要**のためWEBペネトレーションテスト範囲から対象外。  
- ASVS：v5.0.0-10.4.8 / 10.4.9 / 10.4.10 / 10.4.11：**トークン有効期限/失効/UI/スコープ配分は構成/運用確認**のためWEBペネトレーションテスト範囲から対象外。

### V11 暗号（鍵/実装/方針）
- ASVS：v5.0.0-11.1.1 / 11.1.2 / 11.2.1〜11.2.3 / 11.3.3 / 11.4.2〜11.4.4 / 11.5.1 / 11.6.1：**鍵管理/暗号実装/方針の内部確認**のためWEBペネトレーションテスト範囲から対象外。

### V12 通信（mTLS/内部通信）
- ASVS：v5.0.0-12.1.3 / 12.3.3：**mTLS や内部HTTP間TLS強制は内部ネットワーク設計の確認**のためWEBペネトレーションテスト範囲から対象外。

### V13 構成/Secrets（サービス間認証等）
- ASVS：v5.0.0-13.1.1 / 13.2.1〜13.2.5 / 13.3.1 / 13.3.2：**通信要件/サービス間認証/最小権限/Secrets 管理は運用/設計確認**のためWEBペネトレーションテスト範囲から対象外。

### V14 サーバ側データ保護
- ASVS：v5.0.0-14.2.2 / 14.2.3 / 14.2.4：**サーバ/第三者送信/保護実装は運用/実装確認**のためWEBペネトレーションテスト範囲から対象外。

### V15 防御的コーディング（内部実装）
- ASVS：v5.0.0-15.3.4 / 15.3.5 / 15.3.6 / 15.3.7：**元IP引継/型厳密/プロトタイプ汚染/パラメータ汚染はコード実装確認**のためWEBペネトレーションテスト範囲から対象外。

### V16 ログ/エラーハンドリング（設計/運用）
- ASVS：v5.0.0-16.2.1 / 16.2.3 / 16.2.4 / 16.3.3 / 16.3.4 / 16.4.1：**ログ設計/出力先/形式/イベント定義/エラー処理/ログエンコードは運用/実装確認**のためWEBペネトレーションテスト範囲から対象外。

### V17 WebRTC
- ASVS：v5.0.0-17.x：**TURN/DTLS/SRTP/シグナリングの運用・設定・負荷耐性は専門環境の検証が必要**のためWEBペネトレーションテスト範囲から対象外。

---

## 参考（一次情報）
- OWASP ASVS 5.0.0 CSV：<https://raw.githubusercontent.com/OWASP/ASVS/v5.0.0/5.0/docs_en/OWASP_Application_Security_Verification_Standard_5.0.0_en.csv>
- OWASP ASVS プロジェクト：<https://owasp.org/www-project-application-security-verification-standard/>
