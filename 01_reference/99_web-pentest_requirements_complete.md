# Webペネトレーションを始めるための要件（統合版）

> このドキュメントは、Webペネトレーション（攻撃実行を伴うテスト）を開始・業務化するために必要な要件をまとめたものです。  
> **脆弱性診断（Vulnerability Assessment）との違い**を明確にした上で、必要なスキル、ツール、手順、法務的要件、推奨参照サイトを示します。

---

## 目次
1. 概要
2. 前提（スコープと定義）
3. 必須スキル（個人／チーム）
4. 必須ツールと実験環境
5. 推奨方法論／作業フロー
6. 法務・エンゲージメント要件
7. 証跡管理・安全対策
8. ペネトレーションと脆弱性診断の違い（要約）
9. 参考（一次資料・推奨サイト）
10. 付録：快速チェックリスト

---

## 1. 概要
Webペネトレーションは「攻撃者になりきって侵入・横展開・情報持ち出しまで実証する」ことを目的とするセキュリティ評価です。単なる脆弱性の列挙ではなく、**攻撃シナリオの構築と実行（攻撃連鎖）**に重きがあります。本書は技術要件だけでなく、運用・法務・報告の観点も含めた統合的な要件を示します。

---

## 2. 前提（スコープと定義）
- **対象**: Webアプリケーション（SPA/SSR/API含む）。インフラ、ネットワーク機器、クラウド構成、WAF/IdPの設定変更、サブドメイン全探索等は別途合意。  
- **必須合意**: 書面による許可（スコープ、禁止事項、許可アカウント、非破壊条件等）。  
- **ゴール**: 攻撃シナリオを作り、PoCで再現可能にする。影響分析と対応優先度の提示も行う。

---

## 3. 必須スキル（個人／チーム）
- HTTP(S) の深い理解（メソッド、ステータス、ヘッダ、Cookie、CORS、CSP 等）。  
- 認証・セッション管理の深堀（Cookie/JWT/OAuth/MFA）。  
- 主要攻撃手法の実践経験：XSS, SQLi, CSRF, SSRF, IDOR, File Upload, Deserialization, Auth Bypass 等。  
- 攻撃連鎖（Lateral movement / Privilege escalation）を設計し実証できる能力。  
- Burp Suite（Proxy/Intruder/Repeater/Extender/Collaborator）上級操作。  
- スクリプト言語によるPoC作成：Python（requests）、Node.js 等。  
- ローカル脆弱環境の作成・運用（Docker, OWASP Juice Shop, Vuln images）。  
- レポート作成能力（再現手順、スクリーンショット、ログの整理）。

---

## 4. 必須ツールと実験環境
- Burp Suite（Pro推奨）／Browser DevTools／Proxyツール。  
- curl / httpie / Postman / Ocatave 等のHTTPクライアント。  
- Python（requests）、Browser automation（Puppeteer / Playwright は任意）。  
- Docker ベースの脆弱環境（OWASP Juice Shop, vulnerable-flask-app 等）。  
- ログ収集ツール（Burpセッション、tcpdump/PCAP 必要時）。  
- ペイロードリポジトリのローカルコピー（例: PayloadsAllTheThings を `git clone`）。  
- コラボレーション用ドキュメントテンプレート（PoCテンプレ、レポートテンプレ）。

---

## 5. 推奨方法論／作業フロー
1. **準備**
   - 書面許可（スコープ、非破壊ポリシー、許可アカウント）を得る。  
   - 連絡窓口・エスカレーションルールを定める。  
2. **Recon（情報収集）**
   - サブドメイン、公開API、技術スタック、公開バージョン情報、パブリックS3等の確認。  
3. **攻撃計画（脅威モデリング）**
   - 攻撃対象の優先順位付け、攻撃経路の仮設を立てる（MITRE ATT&CK を参照）。  
4. **手動探索＋ペイロード試行**
   - Burp Repeater / Intruder を使い、PayloadsAllTheThings / HackTricks から適切なペイロードを選択して検証。  
5. **PoC 作成**
   - 最小限の再現手順、リクエスト/レスポンス、スクリーンショット、ログを残す。  
6. **深掘り（攻撃連鎖）**
   - 単一脆弱性から横展開（認可回避→情報取得→管理者機能の悪用 等）を検証。  
7. **レポート**
   - サマリ（経営者向け）＋詳細（技術者向け）。再現手順、影響度、修正案、再検査推奨。  
8. **クリーンアップ**
   - 影響除去・ログ共有・第三者への通知（合意があれば）。

---

## 6. 法務・エンゲージメント要件（必須）
- **書面合意（SOW/Terms）**：スコープ、期間、禁止事項、テスト中断条件、データ扱い。  
- **許可アカウントの扱い**：与えるアカウントの権限範囲明示、認証情報の管理方法。  
- **緊急時対応**：重大インシデント発見時の即時連絡先と対応フロー。  
- **ログ・証拠の取り扱い方針**：保存期間、アクセス制御。  
- **コンプライアンス要件**：顧客業界（金融、医療等）による追加制約を反映。

---

## 7. 証跡管理・安全対策
- 全ての検査で**要求・応答を記録**（Burp、PCAP等）。  
- タイムボックスとバックアウト基準を決める（一定回数で停止、エラー発生時即停止）。  
- ステージング環境でのペイロード検証を原則とする。  
- 破壊的な手法（DoS、データ消去）は明示的書面許可がない限り禁止。

---

## 8. ペネトレーションと脆弱性診断の違い（要約）
- **脆弱性診断**：広く浅く、検出と推奨対策が主。通常、低リスク手法を優先。  
- **ペネトレーション**：深く狭く、攻撃シナリオ・攻撃連鎖の実証が主。実害リスクを伴いやすい。  
- **成果物の違い**：脆弱性リスト vs. 攻撃経路＋PoC＋影響評価。

---

## 9. 参考（一次資料・推奨サイト）
以下はこのドキュメントで参照／推奨した主要一次資料です。業務化・教育に使う場合はローカルコピーを保持してください。

- **NIST SP 800-115 — Technical Guide to Information Security Testing and Assessment**  
  https://csrc.nist.gov/publications/detail/sp/800-115/final

- **PTES — Penetration Testing Execution Standard**  
  http://www.pentest-standard.org/index.php/Main_Page

- **OWASP ASVS — Application Security Verification Standard**  
  https://owasp.org/ASVS/

- **OWASP WSTG — Web Security Testing Guide**  
  https://owasp.org/www-project-web-security-testing-guide/latest/

- **MITRE ATT&CK**（Enterprise / relevant matrices）  
  https://attack.mitre.org/

- **HackTricks（実践チートシート）**  
  https://book.hacktricks.xyz/

- **PayloadsAllTheThings（ペイロード集）**  
  https://swisskyrepo.github.io/PayloadsAllTheThings/

- **（参考）Burp Suite ドキュメント / PortSwigger Academy**  
  https://portswigger.net/

---

## 10. 付録：快速チェックリスト（短縮版）
- [ ] 書面でのスコープ合意がある  
- [ ] エスカレーション窓口を設定済み  
- [ ] ステージングにて主要ペイロードを事前検証済み  
- [ ] Burp セッションと必要ログの保存設定済み  
- [ ] PoC テンプレは用意済み（手順・ログ・スクリーンショット）  
- [ ] 重大インシデント時の即時通知ルールを文書化済み
