# ASVS L1（v5.0）Webペネトレーション実務チェックリスト（更新版）
対象：低い保証レベル（L1）のWebアプリに対し、**ブラックボックス中心**で短時間に実施できる「まず押さえる」検査観点と手順。  
要件番号は **v5.0.0-<chapter.section.requirement>** 形式で併記（例：v5.0.0-3.4.1）。

> L1は「First steps / automated / ポートフォリオ俯瞰」に位置付けられる（v5 Dev Guide）。v4.0.3では「人手のペネトレーションテストのみでも検証可能」と記載があったが、実務上は一部で補助情報が必要な場合がある点に留意する。  
> 参照：Developer Guide（レベル定義）、およびASVS 5.0 CSV（要件とレベルの公式一覧）。

---


## 0. 運用前提（必読）
- **ステージング／検証環境限定**で実施。破壊的操作・過負荷・大量試行は不可。  
- **証跡**：テスト日時・リクエスト/レスポンス（ヘッダ含む）・画面キャプチャ・再現手順を残す。  
- **同意**：対象・時間帯・試験範囲（アカウント、機能、API）を事前合意。

---

## 1. HTTP/TLS/ブラウザ保護（基本の外形）
- **HSTSの有効化**（全レスポンスに`Strict-Transport-Security`、max-age≥1年）  
  - 手順：HTTPSアクセス→レスポンスヘッダ確認。  
  - 成果物：レスポンスヘッダ抜粋。  
  - ASVS：v5.0.0-3.4.1
- **CORSの許可元固定**（`Access-Control-Allow-Origin`は固定値または厳格な許可リスト）  
  - 手順：Originを変えてプリフライト/本リクエスト送信→意図外の許可が無いこと。  
  - 成果物：リクエスト/レスポンス一式。  
  - ASVS：v5.0.0-3.4.2
- **コンテンツ種別の整合**（`Content-Type`が実体と一致）  
  - 手順：API/HTML/ファイル応答でMIME不一致がないか確認。  
  - 成果物：レスポンスヘッダと実体。  
  - ASVS：v5.0.0-4.1.1
- **CSRFの基礎対策（Origin/トークン/メソッド）**  
  - 手順：機微操作で①トークン検証、②CORS前提での抜け道（プリフライト回避）、③GET等「safeメソッド」使用の有無を確認。  
  - 成果物：操作画面、送信フォーム/ヘッダ、失敗応答。  
  - ASVS：v5.0.0-3.5.1 / 3.5.2 / 3.5.3
- **TLSのバージョン/必須化/証明書**（追記）  
  - 手順：古いTLS（1.0/1.1）でのハンドシェイクが失敗し、1.2/1.3は成功することを確認。`http://`直アクセスはHTTPSへ強制。外部公開は公的CAの証明書で警告なし。  
  - 成果物：スキャン結果/ネゴシエーションログ、ブラウザ警告の有無。  
  - ASVS：v5.0.0-12.1.1 / 12.2.1 / 12.2.2

> 参考：L2以降でCSP/`X-Content-Type-Options`等が強化される（CSPは3.4.3がL2）。

---

## 2. Cookie/セッションの表層
- **Secure属性**（機密Cookieは`Secure`必須）  
  - 手順：HTTPSレスポンスの`Set-Cookie`を確認（HTTP経由で設定されないことも確認）。  
  - 成果物：ヘッダ抜粋。  
  - ASVS：v5.0.0-3.3.1  
- **（参考/L2）`HttpOnly`・`SameSite`**：可能なら併せて観察（L1必須ではない）。  
  - ASVS：v5.0.0-3.3.2 / 3.3.4（L2）
- **認証直後のセッショントークン再発行（追記）**  
  - 手順：ログイン（再認証含む）前後の`Set-Cookie`/JWTを比較し、**トークンがローテーション**されることを確認。旧トークン再利用は拒否。  
  - 成果物：前後のヘッダ/トークン識別子（例：`jti`）。  
  - ASVS：v5.0.0-7.2.4
- **ログアウト/期限切れ時の無効化（追記）**  
  - 手順：ログアウト後に同一Cookie/JWTでAPIへアクセス→`401/403`となることを確認。  
  - 成果物：ログアウトAPI応答、以後の認可エラー。  
  - ASVS：v5.0.0-7.4.1

---

## 3. 認証（Authentication）の最低限
- **パスワード最小長 ≥ 8**  
  - 手順：登録/変更画面で8文字未満を拒否すること。  
  - ASVS：v5.0.0-6.2.1
- **パスワード変更フロー**（本人の現行PW要求＋変更可）  
  - 手順：変更フォームで現行PWの必須確認／変更が成立すること。  
  - ASVS：v5.0.0-6.2.2 / 6.2.3
- **弱PW/よくあるPWの拒否（上位3,000程度）**  
  - 手順：代表的な弱PW（例：`Password1!` 等）で拒否を確認（少数試行／アカウント保護下）。  
  - ASVS：v5.0.0-6.2.4
- **複雑性「強制しない」**（構成ルールの強制なし）  
  - 観点：文字種必須などの**過度な構成制限が無い**ことをUI/エラーメッセージで確認。  
  - ASVS：v5.0.0-6.2.5
- **UI/UXの追加観点（追記）**  
  - **マスク表示**：パスワード入力は`type="password"`でマスクされ、表示トグルの挙動が適切。  
    - ASVS：v5.0.0-6.2.6  
  - **ペースト/マネージャ許可**：貼り付け禁止や外部管理ツールの妨害がない。  
    - ASVS：v5.0.0-6.2.7  
  - **そのまま検証**：受領PWを**改変せず**（トリム/大文字化等なし）検証。  
    - ASVS：v5.0.0-6.2.8
- **総当たり抑止（レート制御/アカウントロック方針）**  
  - 手順：短時間に連続失敗（3–10回規模、事前許可の範囲内）→遅延/ブロック/追加確認の発動観測。  
  - ASVS：v5.0.0-6.1.1（外形挙動で補助検証）

---

## 4. 入力・エンコード/インジェクション（観点の当てどころ）
> L1は「外形からの安全性確認」に比重。以下は**兆候検知**と**明確な脆弱性確認**を切り分ける。

- **XSSの基礎観察（反射/格納）**  
  - 手順：まず**コンテキスト崩しの無害マーカー**（例：`"><test123`）で反射位置を特定→ステージング限定で簡易ペイロードにより実行可否を検査。  
  - 目的：適切な**出力エンコード**が行われるかの外形確認。  
  - ASVS：v5.0.0-1.2.1 / 1.2.3
- **URL組立ての安全性**（`javascript:`や不正リダイレクト抑止）  
  - 手順：パラメータにスキーム/制御文字を混入し、リンク/遷移が抑止されること。  
  - ASVS：v5.0.0-1.2.2
- **SQLインジェクションの一次確認**  
  - 手順：ID/検索等で**単一引用符 '`'** やサイズ異常を最小限投入→エラー抑止/等価応答で**プリペアド使用の兆候**を確認。  
  - ASVS：v5.0.0-1.2.4
- **OSコマンドインジェクションの一次確認**  
  - 手順：ファイル名やコマンド系入力が想定される箇所にメタ文字（`;|&` など）を**機能に影響しない範囲で**投入→無害化の有無を確認。  
  - ASVS：v5.0.0-1.2.5
- **XXE対策の外形確認**（XMLパーサ設定）  
  - 手順：外部実体を含む**安全なダミーXML**をアップロード/送信→外部参照が無効化されることを確認。  
  - ASVS：v5.0.0-1.5.1

---

## 5. 入力検証/ビジネスロジック（最小限）
- **サーバサイド検証の存在**  
  - 手順：ブラウザでクライアント検証を無効化→不正値がサーバで拒否される。  
  - ASVS：v5.0.0-2.2.1 / 2.2.2
- **手順スキップ耐性**（ステップ順＋トークン整合）  
  - 手順：確認画面スキップ/パラメータ改変での完了可否を確認。  
  - ASVS：v5.0.0-2.3.1

### 認可（Authorization）の最低限（追記）
- **機能レベル認可**：権限のない機能は操作不可。  
  - 手順：権限外エンドポイント（管理系等）へ直接アクセスし 403/適切なリダイレクトを確認。  
  - ASVS：v5.0.0-8.2.1
- **データ（オブジェクト）レベル認可**：他者リソースにアクセス不可（IDOR/BOLA抑止）。  
  - 手順：ID/キーの変更や別テナントID指定で 403/404 となることを確認。  
  - ASVS：v5.0.0-8.2.2

---

## 6. ファイル取扱い（アップロード/保存/配信）
- **サイズ上限**（DoS回避）  
  - 手順：境界サイズで受理/拒否閾値を確認。  
  - ASVS：v5.0.0-5.2.1
- **拡張子・内容整合（マジックバイト等）**  
  - 手順：拡張子偽装（.jpg中にテキスト）等で弾かれること。  
  - ASVS：v5.0.0-5.2.2（L1は**意思決定に使うファイル**に焦点）
- **公開ディレクトリ実行抑止**  
  - 手順：アップロード後に直接アクセス→サーバサイド実行されないこと（例：.phpがダウンロード扱い）。  
  - ASVS：v5.0.0-5.3.1
- **パス操作の無害化**（パストラバーサル抑止）  
  - 手順：ファイル名/パスに`../` 等を混入→拒否/正規化されること。  
  - ASVS：v5.0.0-5.3.2

---

## 7. API/WebSocket
- **WebSocketはWSS**  
  - 手順：機能起動→`wss://`接続と証明書正常性を確認。  
  - ASVS：v5.0.0-4.4.1

---

## 8. データ保護（外形）
- **URLに機微情報を載せない**（トークン/秘密情報はクエリやパスに出ない）  
  - 手順：全フローでURLバーとHTTPラインを確認。  
  - ASVS：v5.0.0-14.2.1
- **ログアウト時のクライアント側クリア**  
  - 手順：ログアウト→`Clear-Site-Data`等でクライアントに残渣がないか。  
  - ASVS：v5.0.0-14.3.1（L1）
- **データ最小化（追記）**：API/レスポンスは**必要なフィールドのみ**返却（不要な属性・機微情報の混入なし）。  
  - 手順：一覧/詳細レスポンスを観察し、余剰属性・内部フラグ・PII露出が無いことを確認。  
  - ASVS：v5.0.0-15.3.1

---

## 9. 構成・情報漏えい（軽量外形）
- **`.git` 等のメタデータ非公開**  
  - 手順：`/.git/HEAD` `/.svn/entries` など既知パスにアクセス→非公開（404/拒否）であること。  
  - ASVS：v5.0.0-13.4.1
- **（参考/L2）TRACE無効・ディレクトリリスティング無効化**  
  - ASVS：v5.0.0-13.4.3 / 13.4.4（いずれもL2）

---

## 10. OAuth/OIDC（採用している場合のみ）
- **リダイレクトURI許可リスト**（完全一致）  
  - 手順：未登録URIで認可開始→拒否を確認。  
  - ASVS：v5.0.0-10.4.1
- **認可コードの使い回し不可／短寿命**  
  - 手順：同一コードの再使用→拒否、寿命（L1は≤10分）を観察。  
  - ASVS：v5.0.0-10.4.2 / 10.4.3

---

## 付録A：推奨の実施順（短時間スクリーニング例：2–4h）
1. **外形ヘッダ/HTTPS**（HSTS・CORS・Content-Type・TLS）  
2. **Cookie表層**（Secure・トークン再発行/失効の挙動）  
3. **認証UI/フロー**（長さ・変更フロー・レート制御の兆候・マスク/ペースト/そのまま検証）  
4. **CSRF最低限**（トークン/Origin/メソッド）  
5. **主要入力点のXSS/SQLi一次確認**  
6. **ファイル機能（あれば）**（サイズ/偽装/実行抑止）  
7. **認可の最低限**（機能/オブジェクトレベル）  
8. **情報漏えい**（`.git`/URL機微情報/データ最小化）  
9. **API/WebSocket**（WSS/型）  
10. **（採用時）OAuth/OIDCの基本3点**

---

## 付録B：報告テンプレ（抜粋）
- **項目**：ASVS参照（例：v5.0.0-3.4.1）  
- **再現**：前提／手順／入出力（ヘッダ含む）  
- **観測**：期待 vs 実測  
- **影響**：想定攻撃・ユーザ影響  
- **改善案**：設定例/実装指針（L1範囲）  
- **証跡**：スクリーンショット/HTTPログ

---

## 付録C：L1の範囲外（ASVS v5.0.0）
### 1.3 出力サニタイズ／動的コード実行
- **v5.0.0-1.3.1**：WYSIWYG入力のサニタイズ実装は**ライブラリ選定・実装確認（コードレビュー）**が必要なため **WEBペネトレーションテスト範囲から対象外**。  
- **v5.0.0-1.3.2**：`eval`/式言語（例：SpEL）の使用有無は**実装内部の確認（コードレビュー）**が必要なため **WEBペネトレーションテスト範囲から対象外**。

### 2.1 入力バリデーション（文書化）
- **v5.0.0-2.1.1**：入力検証ルールの**設計・運用ドキュメント確認**事項のため **WEBペネトレーションテスト範囲から対象外**。

### 3.2 不正コンテキスト描画防止／安全描画
- **v5.0.0-3.2.1**：Sec-Fetch系ヘッダ判定や配信制御は**配信設計・設定レビュー**が中心のため **WEBペネトレーションテスト範囲から対象外**。  
- **v5.0.0-3.2.2**：`createTextNode`/`textContent` 等の使用確認は**レンダリング実装のコードレビュー**が必要なため **WEBペネトレーションテスト範囲から対象外**。

### 6.1 認証攻撃対策（方針の文書化）
- **v5.0.0-6.1.1**：レート制御・アンチ自動化の**方針/設定のドキュメント整合性**は**運用レビュー領域**のため **WEBペネトレーションテスト範囲から対象外**。

### 6.3 認証攻撃対策（文書準拠）／既定アカウント
- **v5.0.0-6.3.1**：対策の**文書準拠性**は**運用レビュー領域**のため **WEBペネトレーションテスト範囲から対象外**。  
- **v5.0.0-6.3.2**：既定ユーザの有無は**アカウント台帳・運用確認**が必要なため **WEBペネトレーションテスト範囲から対象外**。

### 6.4 初期秘密の生成／失効
- **v5.0.0-6.4.1**：初期パスワード/アクティベーションコードの**生成方式・失効運用**は**設計/運用レビュー**が必要なため **WEBペネトレーションテスト範囲から対象外**。

### 7.2 セッショントークン方式／検証
- **v5.0.0-7.2.1 / 7.2.2 / 7.2.3**：トークン検証の実施主体・トークン種別・乱数強度は**内部実装/鍵管理の確認**が必要なため **WEBペネトレーションテスト範囲から対象外**。

### 7.4 アカウント無効化時の全セッション終了
- **v5.0.0-7.4.2**：アカウント無効化連動の一括失効は**バックエンド連携・運用確認**が必要なため **WEBペネトレーションテスト範囲から対象外**。

### 8.1/8.3 認可ポリシー文書／強制位置
- **v5.0.0-8.1.1**：認可ルールの**ポリシー文書**確認事項のため **WEBペネトレーションテスト範囲から対象外**。  
- **v5.0.0-8.3.1**：サービス層での強制有無は**層構成・コード確認**が必要なため **WEBペネトレーションテスト範囲から対象外**。

### 9.1/9.2 自己完結トークン/JWTの検証設計
- **v5.0.0-9.1.1 / 9.1.2 / 9.1.3 / 9.2.1**：署名アルゴリズム許可リスト/鍵供給元/有効期間検証は**内部実装・IdP設定の確認**が必要なため **WEBペネトレーションテスト範囲から対象外**。

### 10.4 OAuth2/OIDC（認可サーバ設定）
- **v5.0.0-10.4.4 / 10.4.5**：許可グラント/RT再利用対策は**認可サーバの設定・運用**確認領域のため **WEBペネトレーションテスト範囲から対象外**。

### 11.3/11.4 暗号方式選定
- **v5.0.0-11.3.1 / 11.3.2 / 11.4.1**：ブロックモード/暗号・ハッシュ選定は**暗号実装・構成レビュー**領域のため **WEBペネトレーションテスト範囲から対象外**。

### 15.1/15.2 依存コンポーネントの更新ポリシー
- **v5.0.0-15.1.1 / 15.2.1**：ライブラリ更新の**リスクベース運用ポリシー**は**運用監査領域**のため **WEBペネトレーションテスト範囲から対象外**。

---

## 参考（一次情報）
- OWASP ASVS プロジェクトページ（最新版5.0.0の説明・ダウンロード）：  
  https://owasp.org/www-project-application-security-verification-standard/
- **ASVS 5.0.0 公式CSV**（要件とレベルの一覧。本文の要件IDはこの版に準拠）：  
  https://raw.githubusercontent.com/OWASP/ASVS/v5.0.0/5.0/docs_en/OWASP_Application_Security_Verification_Standard_5.0.0_en.csv
- OWASP Developer Guide（ASVSの使い方・レベル定義の要約）：  
  https://devguide.owasp.org/en/06-verification/01-guides/03-asvs/  
  https://devguide.owasp.org/en/03-requirements/05-asvs/
- **ASVS 4.0.3 PDF**（L1の「ペンテストのみでも検証可能」記述の出典）：  
  https://raw.githubusercontent.com/OWASP/ASVS/v4.0.3/4.0/OWASP%20Application%20Security%20Verification%20Standard%204.0.3-en.pdf
