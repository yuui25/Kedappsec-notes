# ASVS v5.0 要点サマリ
- 本サマリは ASVS v5.0 の V1〜V10 を前提資料として、Webペネトレーションテスト（WebPT）で実施・判定しやすい検査観点を抽出し、個別要件の扱い（対応/一部対応/範囲外）を整理したもの。
- 範囲外は主に「設計/運用/文書レビュー中心」「構成監査のみで実挙動からは検証困難」などを理由とする。
- https://github.com/owasp-ja/asvs-ja/tree/master/5.0/ja
---

# V1 エンコーディングとサニタイゼーション（ASVS v5.0 観点で再連番化）

> 表列順（固定）：`章/要件ID｜レベル｜要点｜対応可否｜WebPTでの扱い｜備考`

---

## V1.1 エンコーディングおよびサニタイゼーションアーキテクチャ

| 章/要件ID | レベル | 要点 | 対応可否 | WebPTでの扱い | 備考 |
| :---: | :---: | :--- | :---: | :--- | :--- |
| V1.1.1 | L2 | 入力は一度だけ標準形式にデコード／アンエスケープされ、処理前に行うこと（入力バリデーション後に行わない）。 | 部分対応 | 入力のエンコード経路観察、二重デコードの検出（リクエスト差分／侵入テスト） | 実装確認やログ参照があると確実。 |
| V1.1.2 | L2 | 出力エンコーディング／エスケープは最終ステップで行うこと（インタプリタに渡す直前）。 | 部分対応 | 出力のエンコード方法の検証（反射・保存型ペイロードで確認） | ライブラリ自動エスケープの有無はホワイトボックスで評価すると良い。 |

---

## V1.2 インジェクション防御

| 章/要件ID | レベル | 要点 | 対応可否 | WebPTでの扱い | 備考 |
| :---: | :---: | :--- | :---: | :--- | :--- |
| V1.2.1 | L1 | HTML/HTTP/CSS/コメント等、各コンテキストに応じた出力エンコードを行うこと。 | 対応可 | XSS向けペイロードテスト、レスポンスコンテキスト解析 | ブラウザ実行コンテキストで確認可能。 |
| V1.2.2 | L1 | 動的URL構築時はコンテキストに応じたエンコードを行い、危険なプロトコルを許可しない。 | 対応可 | URL生成点のパラメータ操作、プロトコルスキーム検証（javascript:, data: 等拒否） | リダイレクト、open-redirect 諸検査で併せて確認。 |
| V1.2.3 | L1 | 動的に構築する JS/JSON コンテンツは構造を破壊しないようにエンコードすること（JS/JSON 注入防止）。 | 対応可 | JSON/JS を出力するエンドポイントに対するインジェクションテスト | ブラウザ/解析ツールで確認。 |
| V1.2.4 | L1 | DB クエリはパラメータ化／ORM 等で保護し、SQL インジェクションを防ぐこと。 | 対応可 | SQLi ペイロード（盲目含む）、エラーベース／時間差検査 | 一部はホワイトボックス/ログ参照で確証。 |
| V1.2.5 | L1 | OS コマンド呼び出しは適切に保護（パラメータ化やエンコード）されていること。 | 部分対応 | コマンドインジェクションペイロードによる検査（入力→外部影響確認） | 実行環境や出力確認が必要なため限定的。 |
| V1.2.6 | L2 | LDAP インジェクション対策が施されていること。 | 部分対応 | LDAP クエリに関する入力を用いた検査（LDAP ベースの機能が存在する場合） | LDAP サービス利用有無に依存。 |
| V1.2.7 | L2 | XPath/XQuery 等に対するパラメータ化・保護を行うこと。 | 部分対応 | XML/XPath を利用する機能に対するペイロード検査 | サービス構成確認が有効。 |
| V1.2.8 | L2 | LaTeX 等外部プロセッサは安全に構成（例: shell-escape 無効）されること。 | 範囲外 | 設定確認を推奨（ドキュメント生成機能が対象の場合は限定検査） | ビルド／環境の確認が必要。 |
| V1.2.9 | L2 | 正規表現内の特殊文字を適切にエスケープして誤解釈を防ぐこと。 | 部分対応 | 正規表現処理を伴う入力処理の挙動確認（ReDoS 予兆の検査） | ReDoS は負荷試験注意。 |
| V1.2.10 | L3 | CSV／スプレッドシートインジェクション対策（RFC4180 準拠、先頭特殊文字をクオート等）。 | 部分対応 | CSV エクスポート機能に対するフィールド先頭文字検査（エクスポート結果の検査） | エクスポート確認はステージングで慎重に実施。 |

---

## V1.3 サニタイゼーション

| 章/要件ID | レベル | 要点 | 対応可否 | WebPTでの扱い | 備考 |
| :---: | :---: | :--- | :---: | :--- | :--- |
| V1.3.1 | L1 | WYSIWYG 等からの HTML は既知の安全なサニタイズライブラリで処理すること。 | 対応可 | 保存型 XSS の検証、サニタイズ漏れテスト | DOMPurify 等の利用確認は実装確認で確実に。 |
| V1.3.2 | L1 | eval() や SpEL 等の動的コード実行を使用しない／使用時は入力をサニタイズすること。 | 部分対応 | 動的評価が疑われる箇所のペイロード検査（危険箇所の発見） | 使用有無の把握はホワイトボックスで明確化。 |
| V1.3.3 | L2 | 危険なコンテキストへ渡すデータは事前サニタイズ・長さ制限等を実施すること。 | 部分対応 | 長さや許可文字検査、入力整合性の確認 | 実装依存。 |
| V1.3.4 | L2 | SVG 等スクリプト可能コンテンツはスクリプトや foreignObject を含まないよう検証／サニタイズすること。 | 部分対応 | SVG を受け付ける機能に対する検査（表示と挙動） | ブラウザ差異に注意。 |
| V1.3.5 | L2 | Markdown/CSS/XSL/BBCode 等はサニタイズまたは無効化すること。 | 部分対応 | ユーザ生成コンテンツのレンダリング経路でのインジェクション検査 | 変換パイプライン確認が必要。 |
| V1.3.6 | L2 | SSRF 対策としてプロトコル・ドメイン・パス・ポートの許可リスト検証とサニタイズを行うこと。 | 部分対応 | SSRF ペイロード／外部接続検証（リクエスト先制御の検査） | 内部ネットワークへの影響に注意（テスト合意必要）。 |
| V1.3.7 | L2 | テンプレート生成をユーザ入力ベースで動的に許可しないこと。 | 部分対応 | テンプレートエンジン利用箇所のテンプレート注入検査 | 実行環境での確認推奨。 |
| V1.3.8 | L2 | JNDI クエリ等は信頼できない入力をサニタイズし安全に構成すること。 | 部分対応 | JNDI 利用箇所があればテンプレート注入等を検査 | 利用有無の確認が必須。 |
| V1.3.9 | L2 | memcache 送信前のサニタイズを行いインジェクションを防ぐこと。 | 部分対応 | キャッシュに関連する入力の検査（キャッシュ汚染の観察） | 実運用ログ参照で確証。 |
| V1.3.10 | L2 | フォーマット文字列が予期せぬ解決をしないよう事前サニタイズすること。 | 部分対応 | フォーマット処理を伴う機能の入力検査 | 実行時の挙動確認が重要。 |
| V1.3.11 | L2 | SMTP/IMAP 等メール注入対策のため、メール送信前のサニタイズを行うこと。 | 部分対応 | メール送信機能の入力検査（ヘッダ注入等） | 実送信は注意。ステージングで検査推奨。 |
| V1.3.12 | L3 | 正規表現による ReDoS を防ぐため、指数的バックトラッキング要素がないことを保証すること。 | 範囲外（負荷試験注意） | ReDoS 予兆検査（負荷試験的手法） | 負荷試験は事前合意必須。 |

---

## V1.4 メモリ、文字列、アンマネージドコード

| 章/要件ID | レベル | 要点 | 対応可否 | WebPTでの扱い | 備考 |
| :---: | :---: | :--- | :---: | :--- | :--- |
| V1.4.1 | L2 | メモリ安全な文字列操作／安全なメモリコピー等を使用してバッファオーバーフローを防ぐこと。 | 範囲外 | バイナリ／ビルド検査が必要（WebPT は限定的） | バイナリ解析や静的解析が必要。 |
| V1.4.2 | L2 | 整数オーバーフロー防止のため符号・範囲・バリデーションを行うこと。 | 範囲外 | 実装／ビルド確認推奨 | ブラックボックスでは判定困難。 |
| V1.4.3 | L2 | 動的メモリ解放とダングリングポインタ対策（use-after-free 防止）。 | 範囲外 | 主に開発時／ビルド時検査対象 | WebPT 範囲外（ソース/ビルド確認）。 |

---

## V1.5 安全なデシリアライゼーション

| 章/要件ID | レベル | 要点 | 対応可否 | WebPTでの扱い | 備考 |
| :---: | :---: | :--- | :---: | :--- | :--- |
| V1.5.1 | L1 | XML パーサを制限構成にして XXE 等を防止する（外部エンティティ無効化等）。 | 対応可 | XXE 攻撃ペイロードによる検査（XML エンドポイント） | パーサ設定確認はホワイトボックスで確実。 |
| V1.5.2 | L2 | デシリアライズ時は型ホワイトリスト等で許可型を限定し、安全でないメカニズムは信頼できない入力で使用しない。 | 部分対応 | デシリアライズ対象の入力を操作して異常挙動検査（挙動検証） | 実行時のオブジェクト生成経路の把握が有用。 |
| V1.5.3 | L3 | 各種パーサ（JSON/XML/URL）が同一の解析・エンコードを行うよう一貫性を保つこと（相互運用性の問題回避）。 | 部分対応 | 異なるパーサを用いる箇所があれば差分解析の検査 | 実装・設計確認が中心。 |

---

# V2 バリデーションとビジネスロジック
---

## V2.1 バリデーションとビジネスロジックドキュメント

| 章/要件ID | レベル | 要点 | 対応可否 | WebPTでの扱い | 備考 |
| :---: | :---: | :--- | :---: | :--- | :--- |
| V2.1.1 | L1 | 期待される構造に対する入力バリデーションルールを文書化 | 範囲外 | ドキュメント要求・ヒアリングで確認 | 文書管理プロセスの有無を確認 |
| V2.1.2 | L2 | 組合せデータの論理・コンテキスト整合の検証手順を文書化 | 範囲外 | 同上 | 例：地区と郵便番号の整合 |
| V2.1.3 | L2 | ユーザ別/全体のビジネス制限・バリデーション期待事項を文書化 | 範囲外 | 同上 | 権限別ルールの明記 |

---

## V2.2 入力バリデーション

| 章/要件ID | レベル | 要点 | 対応可否 | WebPTでの扱い | 備考 |
| :---: | :---: | :--- | :---: | :--- | :--- |
| V2.2.1 | L1 | 肯定的バリデーション（許容値/パターン/範囲/構造）を適用 | 部分対応 | 代表入力の境界値/無効値テスト、スキーマ差分検証 | L2以上は全入力対象 |
| V2.2.2 | L1 | 信頼できるサーバ側レイヤでバリデーション実施（クライアント依存しない） | 対応可 | クライアント検証バイパス→サーバ側応答確認 | CS側のみ依存の検出 |
| V2.2.3 | L2 | 関連項目の整合チェック（事前定義ルール準拠） | 部分対応 | 相関パラメータ改変での不整合誘発テスト | 例：数量×単価×総額 |

---

## V2.3 ビジネスロジックのセキュリティ

| 章/要件ID | レベル | 要点 | 対応可否 | WebPTでの扱い | 備考 |
| :---: | :---: | :--- | :---: | :--- | :--- |
| V2.3.1 | L1 | 手順省略不可の正しいフロー実行 | 対応可 | ステップスキップ/順序変更の試行 | CSRF/直リンク/強制ブラウジング併用 |
| V2.3.2 | L2 | 文書化されたロジック制限の実装徹底 | 部分対応 | 制限回避シナリオの作成・検証 | 仕様照合が鍵 |
| V2.3.3 | L2 | ロジックレベルでのトランザクション整合（成功/ロールバック） | 部分対応 | 中間失敗時の不整合発生有無を確認 | 二重送信/再試行時の挙動 |
| V2.3.4 | L2 | ロジックロックで限定資源の二重確保防止 | 部分対応 | 競合・同時実行テスト（軽負荷で） | 在庫/枠/座席など |
| V2.3.5 | L3 | 高価値フローの多者承認 | 範囲外 | 手続/運用設計の確認 | 組織プロセス依存 |

---

## V2.4 アンチオートメーション

| 章/要件ID | レベル | 要点 | 対応可否 | WebPTでの扱い | 備考 |
| :---: | :---: | :--- | :---: | :--- | :--- |
| V2.4.1 | L2 | レート制限/クォータ/高コスト機能保護等のアンチオートメーション | 部分対応 | レート超過挙動・CAPTCHA/トークン有無の確認 | 過度な負荷は避ける |
| V2.4.2 | L3 | 人間らしいタイミング要求（過度に速い送信を抑止） | 部分対応 | 連打・自動化送信時の拒否/遅延を確認 | 実装依存が大きい |

---
# V3 ブラウザセキュリティ

## V3.1 Web フロントエンドセキュリティドキュメント

| 章/要件ID | レベル | 要点 | 対応可否 | WebPTでの扱い | 備考 |
| :---: | :---: | :--- | :---: | :--- | :--- |
| V3.1.1 | L3 | 想定ブラウザの必須セキュリティ機能（HTTPS/HSTS/CSP等）と非対応時の動作をドキュメント化 | 範囲外 | ヒアリング・設計資料入手で確認 | 仕様/運用文書の整備状況を確認 |

---

## V3.2 意図しないコンテンツ解釈

| 章/要件ID | レベル | 要点 | 対応可否 | WebPTでの扱い | 備考 |
| :---: | :---: | :--- | :---: | :--- | :--- |
| V3.2.1 | L1 | 不正コンテキストでのレンダリング防止（Sec-Fetch系/Content-Disposition: attachment/CSP sandbox 等） | 対応可 | レスポンスヘッダ/フェッチメタの検証とファイル直参照試験 | ダウンロード/inline挙動を確認 |
| V3.2.2 | L1 | テキスト表示は安全API（createTextNode/textContent等）でHTML/JS実行を防止 | 部分対応 | 反射/保存型XSS観点でUI出力の挙動確認 | 実装詳細は黒箱からは限定的 |
| V3.2.3 | L3 | DOM clobbering回避（厳密宣言/型/グローバル汚染防止/名前空間分離） | 部分対応 | 既知ペイロードでのUI破壊可否/コンソール警告観察 | 実装確認があると確実 |

---

## V3.3 クッキーセットアップ

| 章/要件ID | レベル | 要点 | 対応可否 | WebPTでの扱い | 備考 |
| :---: | :---: | :--- | :---: | :--- | :--- |
| V3.3.1 | L1 | Secure属性必須。__Host-未使用時は__Secure-を使用 | 対応可 | Set-Cookieの属性/プレフィックス検証 | TLS強制前提 |
| V3.3.2 | L2 | SameSiteを目的に応じて設定（CSRF曝露を低減） | 対応可 | クロスサイト送信/iframe等で挙動確認 | Lax/Strict/None+Secureの整合 |
| V3.3.3 | L2 | 共有不要な機密クッキーは__Host-プレフィックス | 対応可 | ドメイン/Path非指定と併せて検証 | __Host-はSecure/Path=/必須 |
| V3.3.4 | L2 | セッショントークン等はHttpOnlyでJSから不可視 | 対応可 | JSからのアクセス可否/ヘッダ確認 | 二重保管（JS+Cookie）禁止 |
| V3.3.5 | L3 | クッキー長（名+値）≤4096B | 部分対応 | 実値の概算・複数クッキーの合計検証 | ブラウザ差異に留意 |

---

## V3.4 ブラウザのセキュリティメカニズムヘッダ

| 章/要件ID | レベル | 要点 | 対応可否 | WebPTでの扱い | 備考 |
| :---: | :---: | :--- | :---: | :--- | :--- |
| V3.4.1 | L1 | HSTS有効（max-age≥1年）。L2+はincludeSubDomains | 対応可 | すべてのレスポンスでHSTS確認/初回HTTP遮断確認 | preloadはV3.7.4 |
| V3.4.2 | L1 | CORSの許可は固定or厳密許可リスト。`*`は機密非含有時のみ | 対応可 | ACAO/ACAC/Originの相関確認 | 動的反射の禁止確認 |
| V3.4.3 | L2 | CSP導入（最低：object-src 'none', base-uri 'none'）。L3はナンス/ハッシュで応答ごと | 部分対応 | ポリシー妥当性/違反発生有無を検証 | 実装依存が大きい |
| V3.4.4 | L2 | X-Content-Type-Options: nosniff を全レスポンスに付与 | 対応可 | MIMEと実コンテンツ整合/ヘッダ確認 | CORB支援も期待 |
| V3.4.5 | L2 | Referrer-Policyで機密の外部漏えい防止 | 対応可 | 内部→外部遷移時のReferer挙動確認 | no-referrer等の適用 |
| V3.4.6 | L2 | frame-ancestorsで埋め込み制御（X-Frame-Options非推奨） | 対応可 | クリックジャッキング検査/埋込可否確認 | 画面埋込点で評価 |
| V3.4.7 | L3 | CSPの違反送信先（report-to/report-uri）定義 | 部分対応 | 違反トリガでレポート送信可否を確認 | 診断用宛先は要合意 |
| V3.4.8 | L3 | COOP（same-origin/…-allow-popups）でタブ分離 | 部分対応 | ヘッダ確認とナビゲーション挙動観察 | window共有防止を確認 |

---

## V3.5 ブラウザのオリジン分離

| 章/要件ID | レベル | 要点 | 対応可否 | WebPTでの扱い | 備考 |
| :---: | :---: | :--- | :---: | :--- | :--- |
| V3.5.1 | L1 | CORS非依存時はCSRFトークン/追加ヘッダで真正性検証 | 対応可 | CSRFトークン有無/検証強度・二重送信可否 | セッション結合/同時対策も |
| V3.5.2 | L1 | CORS依存時はプリフライト回避リクエストで呼べない設計 | 部分対応 | `Origin/Content-Type`/追加ヘッダ要件の検証 | 簡易化ヘッダでの回避不可 |
| V3.5.3 | L1 | 機密操作は安全でないHTTPメソッド（GET等）を使用しない or Sec-Fetch厳格検証 | 対応可 | メソッド/Fetchメタ検証・画像等経由の誤呼び出し検査 | Idempotent設計も確認 |
| V3.5.4 | L2 | 異アプリは異ホストで分離しSOPを活用 | 部分対応 | ホスト名/クッキースコープ/サブドメイン分離確認 | アーキ確認が鍵 |
| V3.5.5 | L2 | postMessageはorigin/構文検証し不正は破棄 | 部分対応 | UI操作でpostMessage経路を観測 | 実装露出が乏しい場合あり |
| V3.5.6 | L3 | JSONPを無効化（XSSI耐性） | 対応可 | `callback=`等の挙動確認/JSONPレス無効を確認 | レガシAPI確認 |
| V3.5.7 | L3 | 認可データをJS資産レスポンスに含めない（XSSI防止） | 部分対応 | 認可要データの取得経路/ヘッダ制御確認 | 静的資産の取り扱い確認 |
| V3.5.8 | L3 | 認証済みリソースの埋込は意図時のみ（Sec-Fetch厳格 or CORP） | 部分対応 | 埋込試行とヘッダ（CORP等）検証 | 埋込失敗時のUX考慮 |

---

## V3.6 外部リソース完全性

| 章/要件ID | レベル | 要点 | 対応可否 | WebPTでの扱い | 備考 |
| :---: | :---: | :--- | :---: | :--- | :--- |
| V3.6.1 | L3 | 外部配信の資産はSRI＋固定版管理。不可なら根拠を文書化 | 部分対応 | `<link>/<script>`のSRI有無と固定版確認 | 文書化は別途確認 |

---

## V3.7 ブラウザのセキュリティに関するその他の考慮事項

| 章/要件ID | レベル | 要点 | 対応可否 | WebPTでの扱い | 備考 |
| :---: | :---: | :--- | :---: | :--- | :--- |
| V3.7.1 | L2 | 廃止/非安全なクライアント技術の不使用（Flash/ActiveX等） | 部分対応 | 資産スキャン/機能確認で残存技術の検出 | 近代ブラウザでは多くが無効 |
| V3.7.2 | L2 | 自動リダイレクトは許可リスト先のみ | 部分対応 | オープンリダイレクト検査＋許可先確認 | 例外経路の洗い出し |
| V3.7.3 | L3 | 外部遷移時に警告とキャンセル手段を提供 | 部分対応 | 外部リンク遷移UI/警告表示の確認 | deep link配慮 |
| V3.7.4 | L3 | ルートドメインのHSTSプリロードリスト登録 | 部分対応 | `Strict-Transport-Security`とpreload状況の確認 | 反映に時間差あり |
| V3.7.5 | L3 | 想定機能を未サポートのブラウザでは文書通りの動作（警告/遮断） | 範囲外 | 仕様・運用確認 | 実装/運用手順依存 |

# V4 Webサービス

## V4.1 一般的な Web サービスセキュリティ

| 章/要件ID | レベル | 要点 | 対応可否 | WebPTでの扱い | 備考 |
| :---: | :---: | :--- | :---: | :--- | :--- |
| V4.1.1 | L1 | Content-Type と実体の一致（文字エンコーディング含む） | 対応可 | 各APIレスの Content-Type/charset とボディ検証 | JSON/CSV/画像等でミスマッチ確認 |
| V4.1.2 | L2 | 人手UI向けのみ HTTP→HTTPS リダイレクト許容 | 部分対応 | APIエンドポイントのHTTP許容/自動リダイレクト有無確認 | 誤送信検知/監査要件と併読 |
| V4.1.3 | L2 | 受信ヘッダの上書き防止（X-Forwarded-*, X-User-ID等） | 部分対応 | 任意ヘッダ注入→アプリ側解釈の確認 | 逆プロキシ/ALB設定依存 |
| V4.1.4 | L3 | サポートHTTPメソッドのみ許可（未使用は拒否） | 対応可 | TRACE/PUT/DELETE など無効メソッド試行 | CORSプリフライト含め確認 |
| V4.1.5 | L3 | 重要トランザクションにメッセージ署名 | 範囲外 | 仕様/運用ヒアリング中心 | 実装確認が必要（黒箱困難） |

## V4.2 HTTP メッセージ構造バリデーション

| 章/要件ID | レベル | 要点 | 対応可否 | WebPTでの扱い | 備考 |
| :---: | :---: | :--- | :---: | :--- | :--- |
| V4.2.1 | L2 | 受信メッセージ境界の厳格化（TE/CL競合処理等） | 部分対応 | TE/CL両立ペイロードやH2/H3差異での挙動確認 | 中間機器設定に依存 |
| V4.2.2 | L3 | 送信時に Content-Length と実フレーム長の不整合回避 | 範囲外 | 生成側制御のため黒箱では限定的 | 代理で逸脱レスが無いか観測 |
| V4.2.3 | L3 | H2/H3で接続固有ヘッダを送受信しない | 対応可 | H2/H3で Transfer-Encoding 等混入の有無確認 | サーバ/ゲートウェイ実装差異 |
| V4.2.4 | L3 | ヘッダ値にCR/LF/CRLFを許容しない | 対応可 | ヘッダインジェクション試行→レス分割/改変の有無 | 代理応答も観測 |
| V4.2.5 | L3 | 過長URI/ヘッダ生成の抑止（DoS回避） | 部分対応 | 長大クエリ/クッキーでの閾値・エラー挙動確認 | プラットフォーム毎に閾値差 |

## V4.3 GraphQL

| 章/要件ID | レベル | 要点 | 対応可否 | WebPTでの扱い | 備考 |
| :---: | :---: | :--- | :---: | :--- | :--- |
| V4.3.1 | L2 | クエリ許可リスト/深さ・コスト制限でDoS防止 | 部分対応 | ネスト/フラグメント乱用での応答時間・リジェクト確認 | 負荷配慮で軽度に実施 |
| V4.3.2 | L2 | 本番での introspection 無効（公開意図なければ） | 対応可 | `__schema`/`__type` クエリ応答可否 | 管理ロール限定なら別評価 |

## V4.4 WebSocket

| 章/要件ID | レベル | 要点 | 対応可否 | WebPTでの扱い | 備考 |
| :---: | :---: | :--- | :---: | :--- | :--- |
| V4.4.1 | L1 | すべて WSS を使用 | 対応可 | `ws://` 拒否/`wss://` 強制確認 | 証明書検証も実査 |
| V4.4.2 | L2 | ハンドシェイク時の Origin 検証 | 対応可 | 異オリジンからの接続試行と拒否確認 | 許可リスト整合を確認 |
| V4.4.3 | L2 | 標準セッション不可時は専用トークンで管理 | 部分対応 | トークン要求/失効/再接続挙動の確認 | 実装詳細の把握が鍵 |
| V4.4.4 | L2 | 専用WSトークンは既存HTTPSセッションを基盤に取得/検証 | 部分対応 | 認証連携の流れとバインド確認 | ミスマッチ時の拒否挙動確認 |

# V5 ファイル処理

## V5.1 ファイル処理ドキュメント

| 章/要件ID | レベル | 要点 | 対応可否 | WebPTでの扱い | 備考 |
| :---: | :---: | :--- | :---: | :--- | :--- |
| V5.1.1 | L2 | 機能ごとの許可拡張子・最大サイズ（展開後含む）・悪性検出時の動作を文書化 | 範囲外 | 仕様・運用文書の有無をヒアリングで確認 | 文書化不備は実装不備の指標 |

---

## V5.2 ファイルアップロードとコンテンツ

| 章/要件ID | レベル | 要点 | 対応可否 | WebPTでの扱い | 備考 |
| :---: | :---: | :--- | :---: | :--- | :--- |
| V5.2.1 | L1 | 処理可能サイズのみ受け付け（DoS防止） | 対応可 | 大容量/境界サイズでエラー挙動確認 | プラットフォームのデフォ閾値も把握 |
| V5.2.2 | L1 | 拡張子と内容（マジックバイト等）の整合検証 | 対応可 | 偽装拡張子/再エンコード画像で検証 | 業務決定に使うファイルを優先 |
| V5.2.3 | L2 | 解凍前に最大非圧縮サイズ・最大ファイル数を検証 | 部分対応 | zip bomb 簡易版で挙動確認（軽負荷） | 本格負荷は事前合意必須 |
| V5.2.4 | L3 | ユーザ毎の容量/件数クォータを適用 | 部分対応 | 連続アップロードで上限適用確認 | ストレージ枯渇の防止策 |
| V5.2.5 | L3 | アーカイブ内シンボリックリンクの拒否（必要時は許可リスト） | 対応可 | symlink/相対リンクを含むzipで展開挙動確認 | 展開先の安全確認も実施 |
| V5.2.6 | L3 | 画像ピクセルサイズ上限でピクセルフラッド防止 | 対応可 | 超高解像画像の拒否/再サンプル有無の確認 | 画像再処理の有無も確認 |

---

## V5.3 ファイル保存

| 章/要件ID | レベル | 要点 | 対応可否 | WebPTでの扱い | 備考 |
| :---: | :---: | :--- | :---: | :--- | :--- |
| V5.3.1 | L1 | 公開領域のアップロード/生成ファイルを実行不可に | 対応可 | Webルート配下の実行可否/拡張子マップ確認 | MIME/拡張子強制ダウンロード化 |
| V5.3.2 | L1 | パス生成は内部ID等を使用し、ユーザ入力は厳格検証 | 対応可 | パストラバーサル/LFI/RFI/SSRF試験 | realpath/許可ディレクトリ確認 |
| V5.3.3 | L3 | 展開処理でユーザ提供のパス情報を無視（zip slip防止） | 対応可 | `../`含むエントリの展開結果を検証 | 展開先のベースパス固定必須 |

---

## V5.4 ファイルダウンロード

| 章/要件ID | レベル | 要点 | 対応可否 | WebPTでの扱い | 備考 |
| :---: | :---: | :--- | :---: | :--- | :--- |
| V5.4.1 | L2 | 応答の Content-Disposition でサーバ側ファイル名を明示 | 対応可 | URL/JSON指定名を無視しヘッダ名が優先か確認 | ヘッダ改行混入に注意 |
| V5.4.2 | L2 | 提供ファイル名をエンコード/サニタイズ（RFC6266遵守） | 対応可 | 非ASCII/制御文字混入時の挙動確認 | CR/LF, 角括弧, 連想ヘッダ注入対策 |
| V5.4.3 | L2 | 信頼できない取得元のファイルをAVスキャン | 範囲外 | スキャン有無は運用/設計確認 | 検知時の隔離/通知手順も確認 |
