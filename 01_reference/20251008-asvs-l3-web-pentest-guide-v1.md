# ASVS L3（v5.0）Webペネトレーション実務チェックリスト
対象：**高保証レベル（L3）**。金融・医療・公共など**高リスク/高価値**なアプリ向け。ブラックボックスに加え、**必要最小限の設計情報・アカウント**の提供を受けた**グレーボックス**前提で、設計/実装/運用を**深く**検証する。  
本書は**非破壊**かつステージング環境での実施を前提とする。

---

## 0) 前提/脅威モデリング
- 想定攻撃者・資産・リスク合意、優先シナリオ定義。**[ASVS: v5.0.0-2.1.1]**

---

## 1) ブラウザ防御（強化）
- **応答ごと CSP**（`nonce`/`hash`、`frame-ancestors`）。**[ASVS: v5.0.0-3.4.3]**
- **COOP/COEP/CORP** を適切に適用。**[ASVS: v5.0.0-3.4.8][ASVS: v5.0.0-3.5.8]**
- 外部アセットは **バージョン固定＋SRI**。**[ASVS: v5.0.0-3.6.1]**

---

## 2) 認証（強化）
- **ハードウェア要素**を含む MFA、**プッシュ爆撃対策**。**[ASVS: v5.0.0-6.3.3][ASVS: v5.0.0-6.6.4]**
- **SMS/PSTN** OTP は使用しない。**[ASVS: v5.0.0-6.6.1]**
- **ステップアップ認証**（高リスク操作）。**[ASVS: v5.0.0-7.5.3]**
- IdP連携は署名/発行者/リプレイ/要求強度を検証。**[ASVS: v5.0.0-6.8.1][ASVS: v5.0.0-6.8.2][ASVS: v5.0.0-6.8.3][ASVS: v5.0.0-6.8.4]**

---

## 3) OAuth2/OIDC（高保証）
- **リダイレクトURI厳密一致**。**[ASVS: v5.0.0-10.4.1]**
- 認可コードは **1回限り/短寿命**。**[ASVS: v5.0.0-10.4.2][ASVS: v5.0.0-10.4.3]**
- **PKCE必須**、`state`/`nonce` の**適切バインド**。**[ASVS: v5.0.0-10.4.6][ASVS: v5.0.0-10.1.2]**
- アクセス/リフレッシュは **送信者拘束（DPoP/mTLS）**。**[ASVS: v5.0.0-10.3.5][ASVS: v5.0.0-10.4.5]**
- リソースサーバは **aud/権限/本人性/強度/新鮮さ** を検証。**[ASVS: v5.0.0-10.3.1][ASVS: v5.0.0-10.3.2][ASVS: v5.0.0-10.3.3][ASVS: v5.0.0-10.3.4]**
- OIDC クライアントは **issuer一致/nonce照合/aud=client_id**。**[ASVS: v5.0.0-10.5.1][ASVS: v5.0.0-10.5.3][ASVS: v5.0.0-10.5.4]**

---

## 4) セッション/トークン（強化）
- 認証直後の **セッションID再発行**。**[ASVS: v5.0.0-7.2.4]**
- **並行セッション制御** と **全セッション失効**。**[ASVS: v5.0.0-7.1.2][ASVS: v5.0.0-7.5.2]**
- 機微操作や権限変更時の **再認証**。**[ASVS: v5.0.0-7.5.1]**

---

## 5) アクセス制御（強化）
- **BOLA/IDOR**・**BFLA**・**テナント越境**の形式的検証。**[ASVS: v5.0.0-8.2.2][ASVS: v5.0.0-8.2.1][ASVS: v5.0.0-8.4.1]**
- **Mass Assignment** 抑止（許可フィールド）。**[ASVS: v5.0.0-15.3.3]**

---

## 6) API/GraphQL/WebSocket（強化）
- **HTTP/2/3 スマグリング耐性**。**[ASVS: v5.0.0-4.2.2][ASVS: v5.0.0-4.2.3][ASVS: v5.0.0-4.2.4]**
- GraphQL: **深さ/複雑度/許可リスト**、本番 **インスペクション無効**。**[ASVS: v5.0.0-4.3.1][ASVS: v5.0.0-4.3.2]**
- WebSocket: **WSS/Origin検証/認可再評価**。**[ASVS: v5.0.0-4.4.1][ASVS: v5.0.0-4.4.2][ASVS: v5.0.0-4.4.4]**

---

## 7) 入力/インジェクション/テンプレ/反序列化
- **文脈別XSS防御 + 厳格CSP**。**[ASVS: v5.0.0-1.3.1][ASVS: v5.0.0-3.4.3]**
- **テンプレート/式言語** 注入抑止。**[ASVS: v5.0.0-1.3.7]**
- **反序列化** の安全化（型固定/許可リスト）。**[ASVS: v5.0.0-1.5.2][ASVS: v5.0.0-1.5.3]**

---

## 8) SSRF/外部呼出し（強化）
- **SSRF防止** と **宛先許可リスト**。**[ASVS: v5.0.0-1.3.6][ASVS: v5.0.0-13.2.4]**
- アウトバウンドの **リダイレクト追従禁止**。**[ASVS: v5.0.0-15.3.2]**

---

## 9) データ保護/暗号/秘密管理（強化）
- **TLS1.2+**、推奨スイート、**ECH** 検討。**[ASVS: v5.0.0-12.1.1][ASVS: v5.0.0-12.1.2][ASVS: v5.0.0-12.1.5]**
- 機微データの **URL/ログ/キャッシュ防止**。**[ASVS: v5.0.0-14.2.1][ASVS: v5.0.0-16.2.5]**
- **Secrets管理**（ボールト/HSM 等）。**[ASVS: v5.0.0-13.3.1][ASVS: v5.0.0-13.3.3]**

---

## 10) ログ/監査/検知（強化）
- **重要イベント監査**・**改ざん防止/安全転送**。**[ASVS: v5.0.0-16.3.1][ASVS: v5.0.0-16.4.2][ASVS: v5.0.0-16.4.3]**
- **一般化エラー** と **フェイルセーフ**。**[ASVS: v5.0.0-16.5.1][ASVS: v5.0.0-16.5.3]**

---

## 付録A：推奨の実施順（目安：**3〜10営業日**）
1. **アーキ/脅威モデリング短セッション** → 優先シナリオ合意  
2. **外形/ヘッダ/CSP/TLS** → **認証/セッション/トークン**  
3. **アクセス制御（水平/垂直/テナント）**（最重点）  
4. **インジェクション/テンプレ/反序列化** → **SSRF/外部呼出し**  
5. **ファイル/画像/アーカイブ** → **API/GraphQL/WebSocket**  
6. **データ保護/暗号** → **ログ/監査/検知**  
7. **供給網/ビルド/Secrets** → **ビジネスロジック**  
8. **可用性/エラー** → 総合リスク整理・是正案

---

## 付録B：L2→L3 差分（要約）
- **設計レビュー/脅威モデリング**の**前提化**。  
- **トークン運用/失効/回転**、**Step-up** 等の**高度運用確認**。  
- **テナント境界/権限**の**形式的検証**（行列/テーブルで網羅）。  
- **CSP/COOP/COEP/CORP/Trusted Types** 等の**強化ヘッダ**。  
- **供給網/ビルド/署名/SBOM**、**監査ログの完全性**。

---

## 付録C：報告テンプレ（L3版抜粋）
- **ASVS 参照**：章/節/要件ID（例：*ASVS v5 “Access Control”*）。  
- **前提**：脅威モデル、環境、ロール、テナント。  
- **手順**：再現ステップ、HTTP入出力、状態遷移図。  
- **観測**：期待 vs 実測（例：JWT再利用検知が機能しない 等）。  
- **影響**：ビジネス/規制影響（漏えい件数、取引不正 等）。  
- **是正案**：設定例/実装方針/運用手順、優先度、見積もり粒度。

---

## 参考（一次情報）
- OWASP ASVS プロジェクト/ダウンロード（v5.0.0）：  
  https://owasp.org/www-project-application-security-verification-standard/
- OWASP Developer Guide（ASVSの使い方とレベル定義）：  
  https://devguide.owasp.org/en/03-requirements/05-asvs/
- OWASP Cheat Sheet Series：  
  https://cheatsheetseries.owasp.org/
- OWASP WSTG（各テスト手順の詳細）：  
  https://owasp.org/www-project-web-security-testing-guide/latest/
