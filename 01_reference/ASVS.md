# ASVSに基づく Webペネトレーション開始要件

## 1. 目的と位置づけ
- **目的**：Webアプリ/APIに対する実攻撃シナリオの再現・連鎖検証を行い、**ASVS要件の充足状況**を実証的に評価する。  
- **ASVSの使い方**：ASVSは**セキュリティ要件の標準**であり、ペンテストの**観点・合格基準**として用いる（WSTGは“手順”、ASVSは“要件”）。

---

## 2. VA（脆弱性診断）との違い
| 項目 | 脆弱性診断（VA） | Webペネトレーションテスト |
|------|------------------|-----------------------------|
| 目的 | 弱点の網羅的列挙・リスク可視化 | 実際の侵害可能性・攻撃連鎖を実証 |
| 手法 | 自動＋簡易手動（定型） | 手動中心（攻撃連鎖・到達確認） |
| 深度 | 浅く広く | 深く狭く（ASVSレベルで定義） |
| 成果 | 脆弱性リスト中心 | 攻撃経路＋影響＋修正指針まで |
| 基準 | WSTGチェックリスト | ASVS要件（L1/L2/L3） |

---

## 3. 事前合意（Rules of Engagement）
- **対象と境界**：ドメイン/環境/API一覧、管理画面・非機能エンドポイントの扱い  
- **非破壊の原則**：可用性を損なう恐れのある攻撃は除外または模擬化  
- **アカウント/権限**：ブラック/グレーの別、複数ロールのテストアカウント提供  
- **ログ・監視連携**：検知/ブロック挙動を観測し、再現性を確保  
- **法令・倫理**：時間帯、レート制限、情報取扱い、録画/キャプチャ許可を明確化  

---

## 4. ASVS準拠のスコーピング
### ■ レベル選定
| レベル | 概要 | 適用対象 |
|--------|------|----------|
| **L1** | 最低限（外部向け一般アプリ） | 公開系アプリ、非機密 |
| **L2** | 標準（大半の業務アプリ） | 業務・個人情報を扱う |
| **L3** | 高度（金融・医療等） | 高機密/高リスクシステム |

- テスト計画では **ASVS要件ID（例：`v5.0.0-1.2.5`）** によるトレーサビリティを付与。

---

## 5. 着手前に必要な入力情報
- システム概要（アーキ図、データフロー、依存サービス）  
- 環境差（本番/ステージング）  
- ロール別ユーザ、認証方式、セッション仕様  
- 主要ユースケース/取引フロー  
- 機微情報の分類と保護要件  
- ロギング方針、外部連携、既知制約・既存対策  
→ **ASVS V1: アーキテクチャ/設計要件**に対応。

---

## 6. ASVS × 攻撃連鎖による検証例
| 検証観点 | 主な攻撃例 |
|-----------|-------------|
| **認証/セッション** | パスワード/SSO/MFA、セッション固定化、Remember-me、トークン失効 |
| **認可制御** | 水平・垂直権限昇格、不可視フィールド操作、強制ブラウジング |
| **入力/エンコーディング** | SQLi、NoSQLi、OSコマンド、テンプレート注入、SSRF、XSS |
| **暗号/機密保護** | 通信/保存時の暗号、鍵管理、秘密情報の出力抑止 |
| **ロギング/監査** | 操作ログの改ざん耐性、プライバシー保護 |
| **API特性** | スコープ検証、認証強度、CORS、レート制御 |

→ 各観点をASVS要件IDと紐付けて、**攻撃チェーン評価**を実施。

---

## 7. 成果物（ASVSトレーサブル）
- **サマリ**：経営層向けに「重要リスク／事業影響／推奨方針」を要約  
- **詳細報告**：各発見事項に  
  - ASVS要件ID（例：`v5.0.0-4.1.2`）  
  - 再現手順、攻撃連鎖図、被害想定、PoC、回避策（設計・実装・運用）  
- **証跡**：リクエスト/レスポンス、ログ抜粋、スクリーンショット  
- **再試験**：修正確認（差分検証）オプション  
- **付録**：スコープ、環境条件、未実施項目、残余リスク

---

## 8. 受け入れ基準（Definition of Done）
- 重大リスク（認証/認可破綻、注入、情報漏えい）がASVSレベル相当で網羅されている  
- 各IssueがASVS要件IDで参照可能  
- 再現性・修正指針が明確  
- 非破壊・法令順守で実施し、関係者レビュー完了

---

## 付録A：VAとWebペネトレの対比（要約）
- **VA**：広く浅く。自動化中心、単発的な脆弱性列挙。  
- **Webペンテ**：深く実証。攻撃連鎖・横展開・影響評価をASVS基準で行う。

---

## 参考ソース
1. **OWASP ASVS Project Page**  
   https://owasp.org/www-project-application-security-verification-standard/

2. **ASVS v5.0.0（最新安定版）**  
   https://github.com/OWASP/ASVS

3. **ASVS vs WSTG の位置づけ**  
   - ASVS：セキュリティ「要件」標準  
   - WSTG：検証「手順」標準  
   （両者を併用することでペネトレーション深度を定義）

4. **VAとPenTestの違い（到達深度・目的の差）**  
   https://owasp.org/www-project-web-security-testing-guide/latest/

5. **ASVS レベル概要（L1/L2/L3）**  
   https://owasp.org/www-project-application-security-verification-standard/#levels

---

## 記載例（報告書向け）
> 「IDORにより他ユーザの明細が取得可能：**`v5.0.0-4.1.2`** 未達（水平アクセス制御）。  
> 再現手順および対策を添付。」

※要件番号は該当章に応じて差し替え。  
ASVSリポジトリの表記規則（`vX.Y.Z-A.B.C`形式）に準拠。

---

**作成者メモ**  
この文書は、ASVSをベースにWebペネトレーションテストを設計・実施するための社内基準案です。  
報告書テンプレート、契約書添付要件、顧客説明資料などに転用可.
