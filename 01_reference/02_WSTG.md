# WSTGに基づく Webペネトレーション開始要件

---

## 要約（1行）
Webペネトレーションは「計画的に攻撃を模擬し、攻撃連鎖や実際の侵害可能性を検証する活動」です。開始前に**スコープ・権限・安全対策・テスト方針・成果物**を明確にし、書面で合意してから実施します。

---

## 1) 前提（最重要） — 実施前に必ず揃えるもの（必須チェックリスト）
1. **明確なスコープ**  
   対象 URL / サブドメイン / API / IP / 資産リスト。除外項目（例：バックエンドDB、クリティカルネットワーク）を明示。  
2. **書面による許可（Rules of Engagement）**  
   テスト範囲・許容する手法（DoSの可否等）・期間を明記した法的承認書。  
3. **連絡窓口と緊急対応手順**  
   テスト中の障害時に連絡する担当者（運用、SRE、法務等）と復旧手順。  
4. **認証情報とテストアカウント**  
   必要な場合は事前にテスト用アカウント/データを用意し、実データ使用の可否を合意。  
5. **業務影響・停止ウィンドウの合意**  
   影響を許容する時間帯（例：業務時間外）や障害時の対応方針。  
6. **報告様式・深度の合意**  
   PoC の取り扱い、ログ添付の可否、再現手順のフォーマットや納期。  
7. **コンプライアンス要件の確認**  
   PCI、個人情報保護法、顧客契約などの制約確認。

---

## 2) 技術的要件（ツール・手法・スキル）
- **マッピング & 情報収集能力**：SPA/SSR/API/認可フローなどアプリ構成を把握する能力。  
- **自動ツール + 手動確認の両立**：自動スキャンで候補を洗い出し、手動で認可バイパスやビジネスロジックを深掘り。  
- **エクスプロイト／PoC作成スキル**：合意範囲内で影響を実証するスキル（安全に実行できること）。  
- **ログ/証跡収集能力**：Burpログ、スクリーンショット、パケットキャプチャ等の証跡収集と整理。  
- **安全対策（スナップショット/バックアップ）**：障害発生時に復旧可能な体制（ステージング鏡像やスナップショット推奨）。

---

## 3) プロセス（段取り）
1. **Pre‑engagement（契約・準備）**  
   スコープ、許可、連絡網、除外項目を確定。  
2. **Recon & Mapping（情報収集）**  
   公開情報収集、アプリマップ、認証フロー理解。  
3. **Threat modelling & 攻撃シナリオ設計**  
   ビジネス影響に基づく優先度付けと攻撃経路設計。  
4. **Vulnerability Analysis（自動＋手動）**  
   DAST や静的情報を起点に手動で深掘り。  
5. **Exploitation / Post‑exploitation**  
   合意した範囲で PoC／エクスプロイトを実施（ログ保持、影響可視化）。  
6. **Reporting & Remediation Support**  
   再現手順、優先度、緩和策、攻撃連鎖図を含む報告書提出と必要に応じたフォロー。

---

## 4) 「Web脆弱性診断」と「Webペネトレーション」— 実務で押さえる差分（表）
| 項目 | 脆弱性診断（Vulnerability Assessment） | Webペネトレーション（Penetration Test） |
|---|---|---|
| 目的 | 既知脆弱性の検出と一覧化 | 攻撃者視点での侵害可能性検証と攻撃連鎖の実証 |
| 手法 | 主に自動スキャン + 確認 | 自動＋高度な手動（認可バイパス、ビジネスロジック） |
| 深度 | 広く浅く（定期的） | 限定範囲で深く掘る（エクスプロイト含む） |
| リスク | 低（通常は非破壊） | 高め（業務障害／法的リスクあり） |
| 運用頻度 | CI/CD 等で定期 | プロジェクト単位／年1〜2回等 |

---

## 5) 実務テンプレ（発注書／要件書にコピペ可）
- **テスト目的**（例：重要データ到達可能性／認可バイパス有無の検証）  
- **対象資産**（完全な URL / サブドメイン / API パス / IP リスト）  
- **除外項目**（例：DoS 試験、特定バックエンド等）  
- **期間・時間帯**（例：2025‑10‑20 09:00 — 2025‑10‑24 18:00、業務時間外のみ実施等）  
- **連絡先／緊急停止条件**（kill‑switch）  
- **署名／許可証**（発注者・責任者の署名）  
- **証跡の扱い**（PoC の提供可否、ログの機密扱い等）  
- **報告フォーマット**（サマリ、詳細、再現手順、攻撃連鎖図、修正提案）

---

## 6) 推奨（運用・Ops 向け）
- 可能なら **ステージング環境** で全攻撃を再現 → 本番は最小限にする。  
- 自動スキャン結果を「出発点」とし、手動検証に十分な工数を割く運用を推奨。  
- 診断・ペネトレーションの結果は「改善サイクル」に組み込み、修正後の再検証を契約に含めると効果的。

---

## 参考（主要ソース）
- OWASP — Web Security Testing Guide (WSTG)（公式）  
  https://owasp.org/www-project-web-security-testing-guide/latest/  
- NIST SP 800‑115 — Technical Guide to Information Security Testing and Assessment（NIST）  
  https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-115.pdf  
- PortSwigger — Web security resources / Web penetration testing 解説  
  https://portswigger.net/web-security  
- PTES — Penetration Testing Execution Standard（フェーズ概念の参考）  
  http://www.pentest-standard.org/  
- 業界比較記事（Pen test vs Vulnerability scan 等の解説記事） — 各社ブログ等を参照

---

## 最後に（短い助言）
1. 最優先は **スコープと許可（書面）** の確保。  
2. WSTG のチェックリストをベースに、ビジネス影響（機微情報優先）で優先順位を付ける運用を推奨。

---

### 付録：発注用チェックリスト（短縮版、1枚で貼れる）
- テスト目的：______  
- 対象（URL / サブドメイン / API）：______  
- 除外項目：______  
- 期間：______（開始 — 終了）  
- 連絡先（運用 / SRE / 法務）：______  
- PoC 提供（可 / 否）：______  
- DoS 許可（可 / 否）：______  
- 署名（発注者）：______  日付：______

