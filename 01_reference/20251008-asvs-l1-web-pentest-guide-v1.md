# ASVS L1（v5.0）Webペネトレーション実務チェックリスト
対象：低い保証レベル（L1）のWebアプリに対し、**ブラックボックス中心**で短時間に実施できる「まず押さえる」検査観点と手順。  
要件番号は **v5.0.0-<chapter.section.requirement>** 形式で併記（例：v5.0.0-3.4.1）。

> L1は「First steps / automated / ポートフォリオ俯瞰」に位置付けられる（v5 Dev Guide）。v4.0.3では「人手のペネトレーションテストのみでも検証可能」と記載があったが、実務上は一部で補助情報が必要な場合がある点に留意する。  
> 参照：Developer Guide（レベル定義）、およびASVS 5.0 CSV（要件とレベルの公式一覧）。

---

## 0. 運用前提（必読）
- **ステージング／検証環境限定**で実施。破壊的操作・過負荷・大量試行は不可。  
- **証跡**：テスト日時・リクエスト/レスポンス（ヘッダ含む）・画面キャプチャ・再現手順を残す。  
- **同意**：対象・時間帯・試験範囲（アカウント、機能、API）を事前合意。

---

## 1. HTTP/TLS/ブラウザ保護（基本の外形）
- **HSTSの有効化**（全レスポンスに`Strict-Transport-Security`、max-age≥1年）  
  - 手順：HTTPSアクセス→レスポンスヘッダ確認。  
  - 成果物：レスポンスヘッダ抜粋。  
  - ASVS：v5.0.0-3.4.1
- **CORSの許可元固定**（`Access-Control-Allow-Origin`は固定値または厳格な許可リスト）  
  - 手順：Originを変えてプリフライト/本リクエスト送信→意図外の許可が無いこと。  
  - 成果物：リクエスト/レスポンス一式。  
  - ASVS：v5.0.0-3.4.2
- **コンテンツ種別の整合**（`Content-Type`が実体と一致）  
  - 手順：API/HTML/ファイル応答でMIME不一致がないか確認。  
  - 成果物：レスポンスヘッダと実体。  
  - ASVS：v5.0.0-4.1.1
- **CSRFの基礎対策（Origin/トークン/メソッド）**  
  - 手順：機微操作で①トークン検証、②CORS前提での抜け道（プリフライト回避）、③GET等「safeメソッド」使用の有無を確認。  
  - 成果物：操作画面、送信フォーム/ヘッダ、失敗応答。  
  - ASVS：v5.0.0-3.5.1 / 3.5.2 / 3.5.3

> 参考：L2以降でCSP/`X-Content-Type-Options`等が強化される（CSPは3.4.3がL2）。

---

## 2. Cookie/セッションの表層
- **Secure属性**（機密Cookieは`Secure`必須）  
  - 手順：HTTPSレスポンスの`Set-Cookie`を確認（HTTP経由で設定されないことも確認）。  
  - 成果物：ヘッダ抜粋。  
  - ASVS：v5.0.0-3.3.1  
- **（参考/L2）`HttpOnly`・`SameSite`**：可能なら併せて観察（L1必須ではない）。  
  - ASVS：v5.0.0-3.3.2 / 3.3.4（L2）

---

## 3. 認証（Authentication）の最低限
- **パスワード最小長 ≥ 8**  
  - 手順：登録/変更画面で8文字未満を拒否すること。  
  - ASVS：v5.0.0-6.2.1
- **パスワード変更フロー**（本人の現行PW要求＋変更可）  
  - 手順：変更フォームで現行PWの必須確認／変更が成立すること。  
  - ASVS：v5.0.0-6.2.2 / 6.2.3
- **弱PW/よくあるPWの拒否（上位3,000程度）**  
  - 手順：代表的な弱PW（例：`Password1!` 等）で拒否を確認（少数試行／アカウント保護下）。  
  - ASVS：v5.0.0-6.2.4
- **複雑性「強制しない」**（構成ルールの強制なし）  
  - 観点：文字種必須などの**過度な構成制限が無い**ことをUI/エラーメッセージで確認。  
  - ASVS：v5.0.0-6.2.5
- **総当たり抑止（レート制御/アカウントロック方針）**  
  - 手順：短時間に連続失敗（3–10回規模、事前許可の範囲内）→遅延/ブロック/追加確認の発動観測。  
  - ASVS：v5.0.0-6.1.1（ドキュ記述を想定だが外形挙動で補助検証）

---

## 4. 入力・エンコード/インジェクション（観点の当てどころ）
> L1は「外形からの安全性確認」に比重。以下は**兆候検知**と**明確な脆弱性確認**を切り分ける。

- **XSSの基礎観察（反射/格納）**  
  - 手順：まず**コンテキスト崩しの無害マーカー**（例：`"><test123`）で反射位置を特定→ステージング限定で簡易ペイロードにより実行可否を検査。  
  - 目的：適切な**出力エンコード**が行われるかの外形確認。  
  - ASVS：v5.0.0-1.2.1 / 1.2.3
- **URL組立ての安全性**（`javascript:`や不正リダイレクト抑止）  
  - 手順：パラメータにスキーム/制御文字を混入し、リンク/遷移が抑止されること。  
  - ASVS：v5.0.0-1.2.2
- **SQLインジェクションの一次確認**  
  - 手順：ID/検索等で**単一引用符 '`'** やサイズ異常を最小限投入→エラー抑止/等価応答で**プリペアド使用の兆候**を確認。  
  - ASVS：v5.0.0-1.2.4
- **OSコマンドインジェクションの一次確認**  
  - 手順：ファイル名やコマンド系入力が想定される箇所にメタ文字（`;|&` など）を**機能に影響しない範囲で**投入→無害化の有無を確認。  
  - ASVS：v5.0.0-1.2.5
- **XXE対策の外形確認**（XMLパーサ設定）  
  - 手順：外部実体を含む**安全なダミーXML**をアップロード/送信→外部参照が無効化されることを確認。  
  - ASVS：v5.0.0-1.5.1

---

## 5. 入力検証/ビジネスロジック（最小限）
- **サーバサイド検証の存在**  
  - 手順：ブラウザでクライアント検証を無効化→不正値がサーバで拒否される。  
  - ASVS：v5.0.0-2.2.1 / 2.2.2
- **手順スキップ耐性**（ステップ順＋トークン整合）  
  - 手順：確認画面スキップ/パラメータ改変での完了可否を確認。  
  - ASVS：v5.0.0-2.3.1

---

## 6. ファイル取扱い（アップロード/保存/配信）
- **サイズ上限**（DoS回避）  
  - 手順：境界サイズで受理/拒否閾値を確認。  
  - ASVS：v5.0.0-5.2.1
- **拡張子・内容整合（マジックバイト等）**  
  - 手順：拡張子偽装（.jpg中にテキスト）等で弾かれること。  
  - ASVS：v5.0.0-5.2.2（L1は**意思決定に使うファイル**に焦点）
- **公開ディレクトリ実行抑止**  
  - 手順：アップロード後に直接アクセス→サーバサイド実行されないこと（例：.phpがダウンロード扱い）。  
  - ASVS：v5.0.0-5.3.1
- **パス操作の無害化**（パストラバーサル抑止）  
  - 手順：ファイル名/パスに`../` 等を混入→拒否/正規化されること。  
  - ASVS：v5.0.0-5.3.2

---

## 7. API/WebSocket
- **WebSocketはWSS**  
  - 手順：機能起動→`wss://`接続と証明書正常性を確認。  
  - ASVS：v5.0.0-4.4.1

---

## 8. データ保護（外形）
- **URLに機微情報を載せない**（トークン/秘密情報はクエリやパスに出ない）  
  - 手順：全フローでURLバーとHTTPラインを確認。  
  - ASVS：v5.0.0-14.2.1
- **ログアウト時のクライアント側クリア**  
  - 手順：ログアウト→`Clear-Site-Data`等でクライアントに残渣がないか。  
  - ASVS：v5.0.0-14.3.1（L1）

---

## 9. 構成・情報漏えい（軽量外形）
- **`.git` 等のメタデータ非公開**  
  - 手順：`/.git/HEAD` 等の既知パスにアクセス→非公開であること。  
  - ASVS：v5.0.0-13.4.1
- **（参考/L2）TRACE無効・ディレクトリリスティング無効化**  
  - ASVS：v5.0.0-13.4.3 / 13.4.4（いずれもL2）

---

## 10. OAuth/OIDC（採用している場合のみ）
- **リダイレクトURI許可リスト**（完全一致）  
  - 手順：未登録URIで認可開始→拒否を確認。  
  - ASVS：v5.0.0-10.4.1
- **認可コードの使い回し不可／短寿命**  
  - 手順：同一コードの再使用→拒否、寿命（L1は≤10分）を観察。  
  - ASVS：v5.0.0-10.4.2 / 10.4.3

---

## 付録A：推奨の実施順（短時間スクリーニング例：2–4h）
1. **外形ヘッダ/HTTPS**（HSTS・CORS・Content-Type）  
2. **Cookie表層**（Secure）  
3. **認証UI/フロー**（長さ・変更フロー・レート制御の兆候）  
4. **CSRF最低限**（トークン/Origin/メソッド）  
5. **主要入力点のXSS/SQLi一次確認**  
6. **ファイル機能（あれば）**（サイズ/偽装/実行抑止）  
7. **情報漏えい**（`.git`/URL機微情報）  
8. **API/WebSocket**（WSS/型）  
9. **（採用時）OAuth/OIDCの基本3点**

---

## 付録B：報告テンプレ（抜粋）
- **項目**：ASVS参照（例：v5.0.0-3.4.1）  
- **再現**：前提／手順／入出力（ヘッダ含む）  
- **観測**：期待 vs 実測  
- **影響**：想定攻撃・ユーザ影響  
- **改善案**：設定例/実装指針（L1範囲）  
- **証跡**：スクリーンショット/HTTPログ

---

## 参考（一次情報）
- OWASP ASVS プロジェクトページ（最新版5.0.0の説明・ダウンロード）：  
  https://owasp.org/www-project-application-security-verification-standard/
- **ASVS 5.0.0 公式CSV**（要件とレベルの一覧。本文の要件IDはこの版に準拠）：  
  https://raw.githubusercontent.com/OWASP/ASVS/v5.0.0/5.0/docs_en/OWASP_Application_Security_Verification_Standard_5.0.0_en.csv
- OWASP Developer Guide（ASVSの使い方・レベル定義の要約）：  
  https://devguide.owasp.org/en/06-verification/01-guides/03-asvs/  
  https://devguide.owasp.org/en/03-requirements/05-asvs/
- **ASVS 4.0.3 PDF**（L1の「ペンテストのみでも検証可能」記述の出典）：  
  https://raw.githubusercontent.com/OWASP/ASVS/v4.0.3/4.0/OWASP%20Application%20Security%20Verification%20Standard%204.0.3-en.pdf
