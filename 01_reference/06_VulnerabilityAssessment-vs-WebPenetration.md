# Web脆弱性診断（VA）とWebペネトレーションテスト（WebPT）の違い


## 比較（要点サマリ）

| 項目 | Web脆弱性診断（VA） | Webペネトレーションテスト（WebPT） | 参考 |
|---|---|---|---|
| 目的 | 既知の弱点の網羅的検出（誤検知を含む可能性） | 悪用可能性とビジネス影響の実証（侵入→横展開→到達点） | [NIST SP 800-115（Testing/Assessmentの定義）](https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-115.pdf) |
| 対象範囲 | 合意URL/機能の広く浅い確認（自動＋軽手動） | 合意範囲内での実攻撃シナリオ検証（深く狭く） | [WSTG（Webテストの範囲/観点）](https://owasp.org/www-project-web-security-testing-guide/latest/) |
| 手法 | スキャナ／チェックリスト中心 | 手動調査＋攻撃連鎖（チェーン）構築 | [PTES（実務手順）](http://www.pentest-standard.org/index.php/Main_Page) |
| 深さ | 可能性の提示（PoCは限定的） | 実際の悪用・横展開・到達点の証明 | [OSSTMM（実証ベースの検査）](https://www.isecom.org/OSSTMM.3.pdf) |
| 横展開（Pivot） | 原則なし（個別脆弱性の列挙） | 積極的に実施（権限昇格・データ横断・境界移動） | [MITRE ATT&CK（横展開の考え方）](https://attack.mitre.org/) |
| エビデンス | 画面・レスポンス・設定の静的証跡 | リクエスト/レスポンス完全形と再現手順、影響計測 | [WSTG（証跡収集の基本）](https://owasp.org/www-project-web-security-testing-guide/latest/) |
| 成果物 | 脆弱性一覧＋推奨対策 | 攻撃ストーリー（Kill Chain）＋影響定量化＋是正優先度 | [NIST SP 800-115（レポート構成）](https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-115.pdf) |
| 安全配慮 | 破壊操作は原則回避 | 事前合意の安全策の下で限定的な実行 | [NIST SP 800-115（ROE/同意）](https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-115.pdf) |
| 工数/コスト | 相対的に低 | 相対的に高 | [PTES（実務手順）](http://www.pentest-standard.org/index.php/Main_Page) |
| 基準/使い分け | ASVSで要件の網羅性を担保 | ASVS/WSTGを根拠に“影響まで”検証 | [ASVS](https://owasp.org/www-project-application-security-verification-standard/) ・ [WSTG](https://owasp.org/www-project-web-security-testing-guide/latest/) |

> 用語メモ：「横展開（Pivot）」= 初期侵入点から権限・資産・境界を拡大して実害に到達する工程（例：一般→管理、テナントA→B、フロント→バックエンド）。

---

## 具体例（簡潔）

### 例1：IDOR → 権限昇格（横展開）
- **VAの結果**：ユーザIDが連番で推測可能。影響は「他ユーザ情報の閲覧の可能性」と記載。
- **WebPTの検証**：実際に他者IDを列挙 → 管理者向けエンドポイントの内部ID規則を特定 → 管理機能に到達（影響＝全ユーザ操作）。
- **最小PoC（抜粋）**：
~~~~
GET /api/users/124/profile HTTP/1.1
Host: target.example
Cookie: session=...
~~~~
- **参考**：  
  - Broken Access Control（OWASP Top 10）: https://owasp.org/Top10/A01_2021-Broken_Access_Control/  
  - IDOR（PortSwigger）: https://portswigger.net/web-security/access-control/idor  
  - ASVS（認可要件）: https://owasp.org/www-project-application-security-verification-standard/

---

### 例2：SSRF → メタデータ漏えい → 機密取得
- **VAの結果**：URLフェッチ機能で外部到達可能、SSRF「の可能性」。
- **WebPTの検証**：内部宛のHTTP到達性を確認 → メタデータサービスからクレデンシャル/署名URLを取得（影響＝ストレージ機密取得）。
- **最小PoC（抜粋）**：
~~~~
POST /fetch HTTP/1.1
Host: target.example
Content-Type: application/json

{"url":"http://169.254.169.254/latest/meta-data/iam/security-credentials/"}
~~~~
- **参考**：  
  - SSRF（PortSwigger）: https://portswigger.net/web-security/ssrf  
  - SSRF Prevention Cheat Sheet（OWASP）: https://cheatsheetseries.owasp.org/cheatsheets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html  
  - WSTG（SSRF観点）: https://owasp.org/www-project-web-security-testing-guide/latest/

---

### 例3：Stored XSS → セッション乗っ取り → PII閲覧
- **VAの結果**：コメント欄で`<script>`検知、影響は「XSSの可能性」。
- **WebPTの検証**：被害者閲覧時にスクリプト実行を確認 → アプリ固有の認可不備と組合せ、他者アカウントの個人情報（PII）閲覧を実証。
- **最小PoC（概念）**：安全なステージングで`<img src=x onerror=...>`等を用い、トークン取り扱い/認可境界の破り方を評価（本番の機密送信は禁止）。
- **参考**：  
  - XSS（PortSwigger）: https://portswigger.net/web-security/cross-site-scripting  
  - ASVS（出力エンコーディング/セッション管理）: https://owasp.org/www-project-application-security-verification-standard/  
  - WSTG（XSS観点）: https://owasp.org/www-project-web-security-testing-guide/latest/

---

## 使い分けの指針（短評）
- まず**VA**で広く弱点の洗い出し（ASVS/WSTG準拠）。  
- 重要資産・高リスク領域は**WebPT**で「影響が出せるか」を実証。特に**横展開**が懸念される設計（マルチテナント、管理機能、外部連携）はWebPTの対象に優先指定。  
- 参考：  
  - ASVS（要件の網羅管理）：https://owasp.org/www-project-application-security-verification-standard/  
  - WSTG（具体的テスト設計）: https://owasp.org/www-project-web-security-testing-guide/latest/  
  - NIST SP 800-115（評価の全体設計）: https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-115.pdf  
  - PTES（実務プロセス）: http://www.pentest-standard.org/index.php/Main_Page
