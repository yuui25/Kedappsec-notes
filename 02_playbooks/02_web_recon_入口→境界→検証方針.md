<<<BEGIN>>>
# 02_web_recon_入口→境界→検証方針.md

（先頭要約：このプレイブックの位置づけ）
- 目的：Webの入口（画面/API）を「境界（資産/信頼/権限）」で整理し、検証方針（何を優先し、どこまでやるか）を最短で作る
- 主役：エンドポイント列挙の量ではなく、観測の意味（状態）と分岐（次の一手）
- 接続：ASM/OSINTの結果（資産境界）を引き継ぎ、AuthN/AuthZ/API/Input/Config の深掘りへ繋ぐ

## 目的（このプレイブックで到達する状態）
- Webアプリの攻撃面を、次の順で“実務で使える形”に落とす。
  1) 入口の確定（どこから入るか：UI/API/管理/連携）
  2) 境界の確定（資産/信頼/権限）
  3) 優先度の確定（何を先に深掘るか）
  4) 検証方針の確定（A/B分岐、最小証跡）
- “ツールで拾えたURL一覧”ではなく、**攻撃者が次に何をするか** を説明できる。

## 前提（対象・範囲・想定）
- 対象：許可されたWebアプリ、関連API、管理画面、認証基盤（SSO含む）、外部連携（SaaS/Storage等）。
- 想定：
  - UIとAPIで権限がズレる（BOLA/BFLAの温床）
  - 入口は複数あり、境界（信頼/権限）を跨ぐ点が勝負所になる
- 依存（接続先）：
  - ASMの入力：`02_playbooks/01_asm_passive-recon_資産境界→優先度付け.md`
  - Topics：`01_topics/02_web/01_web_recon_入口・境界・攻め筋の確定.md`
  - 観測基盤：`04_labs/01_local/02_proxy_計測・改変ポイント設計.md`

## 入力（このプレイブックの開始条件）
- 対象URL（上位3〜5の入口候補で良い）
- ログインの有無（匿名で見える範囲 / 認証後に見える範囲）
- 既知の外部依存（SSO、CDN、Storage、分析、通知など：分かる範囲）

## 観測の進め方（順序固定：入口→境界→優先度→方針）
### 1) 入口を確定する（UI/API/管理/連携を分ける）
- 観測するもの（例）
  - UI入口：トップ、検索、購入、投稿、ファイル、設定
  - API入口：/api、GraphQL、モバイルAPI、内部API
  - 管理入口：/admin、管理コンソール、運用ツール
  - 連携入口：SSO、Webhook、外部Storage、外部決済等
- ここで確定したい状態
  - 入口を“役割”で説明できる（例：管理は別権限、APIが本体、連携が多い）

### 2) 境界を確定する（資産/信頼/権限の3つだけ）
- 資産境界（何を守るか）
  - 例：ユーザーデータ、注文、設定、権限、トークン、ファイル
- 信頼境界（第三者をまたぐか）
  - 例：IdP（SSO）、CDN/WAF、SaaS、外部Storage、外部通知
- 権限境界（どこで切り替わる/伝播するか）
  - 例：ロール、テナント、所有者、グループ、共有、委任（scope）
- ここで確定したい状態
  - “どの境界が崩れると何が起きるか” を一言で言える

### 3) 観測で「検証対象の芯」を作る（差分で固める）
- 重要：一覧化より差分
  - ログイン前後の差（見える画面/機能/API）
  - 役割差（一般ユーザー/管理者/別ロール）
  - テナント差（別組織/別プロジェクト/別グループ）
- ここで確定したい状態
  - 「このアプリはどこで権限を決めているか（AuthZの芯）」が見える

### 4) 優先度を付ける（勝負所＝境界が動く地点）
- 優先度の軸（高→低）
  1) 認証境界（SSO/ログイン/セッション）が絡む入口
  2) 権限境界（ロール/所有者/共有/テナント）が絡む入口
  3) API中心で権限伝播が複雑な入口
  4) 設定・運用境界（CORS/ヘッダ/Secrets/外部連携）が絡む入口
  5) 単純な匿名閲覧のみの入口（影響が限定的）
- ここで作る成果
  - 上位3〜5の“深掘り対象”と、その根拠（境界の観測）を短く添える

### 5) 検証方針を作る（A/B分岐と最小証跡）
- 方針は「何を試すか」ではなく「どの境界を壊しに行くか」
- 最小証跡
  - 対象：入口URL/機能
  - 条件：主体（ロール/ユーザー）、セッション状態、テナント
  - 観測：主要リクエスト/レスポンス（必要ならHAR）
  - 解釈：境界がどう効いているか（状態）
  - 次：A/B分岐の選択理由

## 判断（A/B分岐：次の一手）
### 分岐A：SSO/トークンの挙動が鍵（認証境界が本体）
- 次の一手
  - `02_playbooks/03_authn_観測ポイント（SSO/MFA前提）.md`
  - 技術ユニット：`01_topics/02_web/02_authn_認証・セッション・トークン.md`
  - SaaS連携：`01_topics/04_saas/01_idp_連携（SAML OIDC OAuth）と信頼境界.md`

### 分岐B：権限のズレが勝負（AuthZが本体）
- 次の一手
  - `02_playbooks/04_authz_境界モデル→検証観点チェック.md`
  - 技術ユニット：`01_topics/02_web/03_authz_認可（IDOR BOLA BFLA）境界モデル化.md`

### 分岐C：APIが本体（UIは薄く、権限はAPIで決まる）
- 次の一手
  - `02_playbooks/05_api_権限伝播→検証観点チェック.md`
  - 技術ユニット：`01_topics/02_web/04_api_権限伝播・入力・バックエンド連携.md`

### 分岐D：入力が本体（テンプレ/デシリアライズ等の“実行境界”がありそう）
- 次の一手
  - 技術ユニット：`01_topics/02_web/05_input_入力→実行境界（テンプレ デシリアライズ等）.md`
  - 検証はLabsで再現（観測点を明確にしてから）

### 分岐E：設定・運用が本体（CORS/ヘッダ/Secrets/外部連携）
- 次の一手
  - 技術ユニット：`01_topics/02_web/06_config_設定・運用境界（CORS ヘッダ Secrets）.md`
  - SaaS：`01_topics/04_saas/02_saas_共有・外部連携・監査ログの勘所.md`

## 出力（このプレイブックの成果物：最小セット）
- 入口マップ（上位3〜5）
  - 入口名 / 役割（UI/API/管理/連携） / 資産境界 / 信頼境界 / 権限境界 / 優先度理由（1〜2行）
- 方針メモ（A/B分岐）
  - まず壊す境界（認証/権限/外部連携/入力/設定）
  - 次に見るポイント（観測項目）
  - 最小証跡（何を残すか）

## ガイドライン対応（ASVS / WSTG / PTES / MITRE ATT&CK：毎回）
- ASVS：
  - 認証/認可/秘密情報/監査の要求を、入口と境界（どこで成立するか）に落とし、深掘り対象の優先度を作る
- WSTG：
  - テスト観点を “どこを見るか” に変換し、差分観測（ログイン前後/ロール差/テナント差）で検証を外さない
- PTES：
  - Intelligence Gathering：入口と外部依存（信頼境界）を確定
  - Vulnerability Analysis：境界崩壊の影響で優先度を付け、次の手（AuthN/AuthZ/API等）へ繋ぐ
- MITRE ATT&CK：
  - 戦術：Discovery（アプリ構造把握）を、Credential Access/Privilege Escalation（越権）へ繋ぐ前提として扱う

## 関連リンク（リポジトリ内：必要最小限）
- 技術ユニット（Web）
  - `01_topics/02_web/01_web_recon_入口・境界・攻め筋の確定.md`
  - `01_topics/02_web/02_authn_認証・セッション・トークン.md`
  - `01_topics/02_web/03_authz_認可（IDOR BOLA BFLA）境界モデル化.md`
  - `01_topics/02_web/04_api_権限伝播・入力・バックエンド連携.md`
  - `01_topics/02_web/05_input_入力→実行境界（テンプレ デシリアライズ等）.md`
  - `01_topics/02_web/06_config_設定・運用境界（CORS ヘッダ Secrets）.md`
- SaaS（連携）
  - `01_topics/04_saas/01_idp_連携（SAML OIDC OAuth）と信頼境界.md`
  - `01_topics/04_saas/02_saas_共有・外部連携・監査ログの勘所.md`
- ASM（前段）
  - `02_playbooks/01_asm_passive-recon_資産境界→優先度付け.md`

<<<END>>>
