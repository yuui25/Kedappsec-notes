<<<BEGIN>>>
# 01_web_targets_検証用アプリ選定.md

## 目的（この技術で到達する状態）
- Webペネトレーション（Web:NW=5:5のWeb側）を「項目理解」ではなく **観測→差分→意思決定** まで回せるように、検証用アプリ（教材）を最小セットで選べる。
- 認証/セッション/認可/API/入力/設定の“境界”を、実通信（Proxy/HAR）と証跡（ログ）で説明できる教材を確定する。
- 選定した教材を「差し替え可能」な運用にし、学習と実務の検証手順を同じ型（観測点固定・巻き戻し前提）で回せる。

## 前提（対象・範囲・想定）
- 対象：自前検証環境（VirtualBox想定）。VMwareは今は扱わない（必要になった時に `04_labs/02_virtualization/02_vmware_基盤.md` を作る）:contentReference[oaicite:1]{index=1}。
- 構成の前提（観測点固定）：
  - Attack Box：ブラウザ/Proxy/pcap等の観測・改変・証跡集約
  - Target（Web教材）：Host-Only等の閉じたセグメントで稼働（外部に露出させない）
- 依存（関連ファイル）：
  - `04_labs/01_local/02_proxy_計測・改変ポイント設計.md`
  - `04_labs/01_local/03_capture_証跡取得（pcap/har/log）.md`
  - `04_labs/02_virtualization/03_networking_nat_hostonly_bridge.md`
  - `04_labs/05_automation/02_snapshots_reset_検証の巻き戻し.md`
- 想定：
  - 教材アプリは Docker で動かせるものを優先（差し替え・復帰が速い）
  - “脆弱性の種類の網羅”は目的ではない。境界（資産/信頼/権限）が学べる最小構成から始める。

## 観測ポイント（何を見ているか：プロトコル/データ/境界）
- 選定時に見るべき「境界（Boundary）」の作りやすさ
  - 資産境界：どこにデータ（ユーザ情報/注文/管理機能）があり、どこが“守るべき領域”か
  - 信頼境界：外部依存（IDP/メール/外部API相当）やCORS/リダイレクト等で“外へ出る点”があるか
  - 権限境界：ロール/管理画面/テナント/オブジェクトIDなど、境界を跨ぐ入力が明確か
- 通信観測で差分を作れるか（Proxy/HAR向きか）
  - ログイン前後で 200/302/401/403 の差分が出る
  - Cookie / Authorization / CSRF / Origin 等が観測でき、改変して差分が取れる
  - API（JSON）やファイルアップロードなど“入力の解釈境界”が含まれる
- 証跡（ログ）と巻き戻しが成立するか
  - 再現に必要なデータが「作り直せる」または「巻き戻しで戻せる」
  - 余計な外部通信がない（閉じたセグメントで完結しやすい）

## 結果の意味（その出力が示す状態：何が言える/言えない）
- ここでの「選定結果」が示す状態
  - 選んだ教材は、WSTG/ASVSの観点を **“通信差分”として再現**できる（＝検証の型が作れる）
  - 観測点（Proxy/HAR/pcap）と巻き戻し（snapshot/reset）により、結論がブレにくい
- 選定だけでは言えないこと
  - 実務対象の固有実装・固有の権限モデルは一致しない（教材は“境界の練習台”）
  - “同じ脆弱性名”でも成立条件は異なる（教材で身につけるのは成立条件の切り分け）

## 攻撃者視点での利用（意思決定：優先度・攻め筋・次の仮説）
- 教材選定＝「攻め筋の型」を先に作る
  - 認証/セッションを鍛える教材：セッション更新、失効、CSRF、Cookie属性の差分が取りやすいもの
  - 認可（IDOR/BOLA等）を鍛える教材：オブジェクトID・ロール・管理機能が明確で差分が出るもの
  - 入力→実行境界を鍛える教材：入力経路が複数あり、サーバ側の解釈差分が出るもの
- 観測点固定の意思決定
  - “教材を増やす”より先に、同一教材で差分セット（例：未ログイン/一般/管理者）を取れるかを優先する
  - 観測できない要素（HTTP/3やピンニング等）が出たら、教材の問題か観測点の問題かを切り分ける

## 次に試すこと（仮説A/Bの分岐と検証）
### 仮説A：最小セットで「Webの境界」を広く回したい
- 選定（推奨：まず2つ）
  - OWASP Juice Shop：現代的な不安全Webアプリで、多数の課題を持つ（Dockerで動かせる）:contentReference[oaicite:2]{index=2}
  - DVWA：PHP/MySQLの典型脆弱性を段階的に扱える教材（Dockerイメージがある）:contentReference[oaicite:3]{index=3}
- 取りたい最小差分セット（例）
  - 未ログイン → ログイン後（Cookie/Authorization差分）
  - 一般 → 管理者（権限差分：403/機能差）
- 次の一手
  - 差分が取れたら、`04_labs/01_local/02_proxy_...` に戻って「改変ポイント」を固定し、同条件比較で検証を回す

### 仮説B：Java系の“典型的なWeb脆弱性の学習動線”を明確にしたい
- 選定
  - OWASP WebGoat：Java系の典型脆弱性を学ぶ目的の教材で、Dockerで動かせる前提が整っている:contentReference[oaicite:4]{index=4}
- 次の一手
  - 教材を増やす前に、認証/セッション/認可の「観測点（どのヘッダ/トークンが境界か）」を言語化して、差分説明できる状態にする

### 仮説C：教材が“多すぎて比較不能”になりそう
- 分岐基準（増やす条件）
  - 既存教材で「差分セット（2条件以上）」が取れていて、説明ができる
  - 追加教材は「埋めたい境界」が明確（例：SSO相当、GraphQL相当、ファイルアップロード相当）
- 次の一手
  - 追加は1つずつ。増やすたびに、観測点・証跡・巻き戻しが崩れていないかを確認する

## ガイドライン対応（ASVS / WSTG / PTES / MITRE ATT&CK）
- ASVS：
  - V2 認証、V3 セッション管理、V4 アクセス制御、V5 入力検証、V8 データ保護、V10 エラー/ロギング等を「教材の差分」で再現して説明する土台
- WSTG：
  - WSTG-ATHN（認証）、WSTG-SESS（セッション）、WSTG-ATHZ（認可）、WSTG-INPV（入力）、WSTG-CONF（設定）を“観測→差分”に落とす
- PTES：
  - Pre-engagement（検証環境/教材選定）→ Intelligence Gathering（観測）→ Vulnerability Analysis（差分解釈）→ Exploitation（成立条件の切り分け）へ接続
- MITRE ATT&CK：
  - Reconnaissance / Discovery（攻撃面・境界把握）、Credential Access（認証/セッションの観測）、Collection（データ到達性の確認）を教材で再現する

## 参考（必要最小限）
- OWASP Juice Shop（概要/実行ガイド）:contentReference[oaicite:5]{index=5}
- OWASP WebGoat（概要/Docker前提）:contentReference[oaicite:6]{index=6}
- DVWA（Dockerイメージ）:contentReference[oaicite:7]{index=7}

---

<<<END>>>
