<<<BEGIN>>>
# 00_index.md（Cloud：AWS/Azure検証環境の全体像と狙い）

## 目的（この技術で到達する状態）
- AWS/Azure を「触れる」ではなく、**境界（資産/信頼/権限）→観測→差分→意思決定**として回せる検証環境を設計・運用できる。
- Web/NW=5:5 の前提として、クラウド特有の攻撃面（IAM/ネットワーク/ストレージ/メタデータ/外部公開）を **“構成差分”として再現**し、結論を証跡で説明できる。
- “壊して学ぶ”を成立させるために、IaC とログ（監査）と巻き戻し（snapshot/reset 相当）を前提化する。

## 前提（対象・範囲・想定）
- 対象：自分が管理するクラウドアカウント/サブスクリプション、または明示的に許可された検証環境のみ。
- 想定：クラウドは「設定=挙動」。同じアプリでも IAM/ネットワーク/公開範囲/ログ設定の差で結論がブレる。
- やらないこと：
  - 実環境や他者資産に対する探索・侵害を意図した内容
  - 手順書化（クリック手順の羅列）で終えること
- 依存（観測点・巻き戻しの土台）：
  - `04_labs/01_local/`（Proxy/HAR/pcap/ログの取り方）
  - `04_labs/05_automation/01_iac_terraform_or_bicep.md`（IaCで“同条件比較”を成立させる）
  - `04_labs/05_automation/02_snapshots_reset_検証の巻き戻し.md`（復帰の考え方）

## 観測ポイント（何を見ているか：プロトコル/データ/境界）
### 1) 資産境界（どこまでが対象か）
- アカウント/サブスクリプション、テナント、プロジェクト単位の境界
- VPC/VNet、サブネット、SG/NSG、ルート、FW、LB、API Gateway などの境界
- ストレージ（S3/Blob等）と鍵（KMS/Key Vault等）の境界
- どの資産が「インターネット公開」か／「社内相当」か（公開面の定義）

### 2) 信頼境界（どこから先が第三者/外部連携か）
- IdP/SSO（SAML/OIDC）とクラウドIAMの境界（誰が“身元”を保証しているか）
- 外部連携（Webhook、外部API、SaaS連携、CI/CD）でデータが出入りする境界
- クラウドメタデータ/インスタンスロール等の“内部だが強い境界”（到達性と保護）

### 3) 権限境界（どこで権限が切り替わる/伝播するか）
- IAM：ユーザ/ロール/ポリシー/条件（Condition）/一時クレデンシャルの境界
- “管理系APIが叩ける”境界と、“データに触れる”境界を分けて観測する
- 権限伝播：アプリ→クラウドAPI、ワーカー→ストレージ、関数→他サービスの境界

### 4) 証跡（クラウド特有の観測）
- 監査ログ：誰が/いつ/どのAPIを/どの条件で実行したか
- ネットワークログ：到達性と通信の痕跡（フロー/Firewall/LBアクセス）
- 変更履歴：設定差分（“いつ何が変わったか”）を追える状態

## 設計方針（必ず守る）
- クラウドは「検証環境=再現の教材」。本番っぽさより **差分比較** を優先する。
- “クラウド側の観測”と “ローカル側の観測（Proxy/HAR/pcap）”を両立させる。
- 巻き戻しは「スナップショット」ではなく、原則 **IaCで再現**（差分の再生成）として設計する。
- コスト/影響を制御する：
  - 公開面は必要最小限
  - 破壊的な検証は閉域・短時間・復帰前提
  - 不要資産は即削除（残骸が“次の検証”を壊す）

## このフォルダで扱う範囲（04_cloud の役割）
- AWS/Azure の “検証用の最小構成”を、境界と観測点が説明できる形で定義する。
- Web/NWの学習をクラウドへ接続する：
  - Web：認証/認可/API/設定（CORS/ヘッダ/Secrets/外部連携）
  - NW：到達性/セグメント/経路/ログ相関
- クラウド監査ログ（証跡）を「結論の根拠」として運用に組み込む。

## 全体像（最小で強い標準構成）
~~~~
[Attack Box / Local]
  - Proxy / HAR / pcap / notes（観測点固定）
        |
        | HTTPS / API calls
        v
[Cloud]
  - 公開面（最小）：LB / API Gateway / Web App 等
  - 内部面：VPC/VNet, Subnet, SG/NSG, Private endpoints 等
  - IAM：ロール/ポリシー/一時クレデンシャル
  - Logging：監査ログ + ネットワークログ + 変更履歴
~~~~

## ファイル構成（このフォルダ内）
- `00_index.md`：入口（このファイル）
- `01_aws_lab_構成と検証観点.md`：AWSでの最小構成、境界、観測点、差分セット
- `02_azure_lab_構成と検証観点.md`：Azureでの最小構成、境界、観測点、差分セット
- `03_logging_クラウド監査ログの取り方.md`：監査ログ/ネットワークログ/相関キーと“結論の根拠”の作り方

## 次に試すこと（仮説A/Bの分岐と検証）
- 仮説A：クラウドの理解が「サービス名の暗記」で止まっている
  - 次の検証：
    - 01_aws_lab / 02_azure_lab で、同じ目的（例：Web公開+内部API+ストレージ）を最小構成で作る
    - “公開面/内部面/IAM/ログ”の4境界を言語化してメモに残す
  - 期待する観測：
    - どの設定差が、どの挙動差（到達性/権限/ログ）になるか説明できる
- 仮説B：挙動は見えるが、結論の根拠（証跡）が残らない
  - 次の検証：
    - `03_logging_...` の最小セット（監査+NW+変更履歴）を入れて、同条件比較の証跡を揃える
  - 期待する観測：
    - 「誰が/いつ/どのAPIで/何を変えたか」と「通信の痕跡」が結びつく
- 仮説C：巻き戻しが重く、反復が止まる
  - 次の検証：
    - IaCで“作り直す”前提に寄せ、検証単位を小さくする（差分セットを減らす）
  - 期待する観測：
    - 検証→破壊→復帰が短サイクルになり、学習が前に進む

## 手を動かす検証（このフォルダの完了条件）
- AWS または Azure のどちらかで、最小構成の検証環境が作れる（公開面/内部面/IAM/ログが説明できる）。
- ローカル観測（Proxy/HAR/pcap）とクラウド観測（監査/NW/変更履歴）を、同一の検証メモで相関できる。
- 巻き戻し（IaC再適用/再作成）で、同条件比較が成立する。

## コマンド/設定例（例示は最小限）
~~~~
# 目的：巻き戻しを「再作成」で成立させる（手順の本体は 05_automation 側に寄せる）
# terraform init
# terraform apply
# terraform destroy
~~~~
- この例で観測していること：環境差を“再現”できるか（同条件比較の土台）
- 出力のどこを見るか：構成（境界）が固定され、ログ/証跡が毎回同じ観測点で取れるか

## ガイドライン対応（ASVS / WSTG / PTES / MITRE ATT&CK：毎回記載）
- ASVS：
  - 該当領域/章：V1（アーキテクチャ）/ V4（アクセス制御）/ V7（エラー処理・ログ）/ V12（ファイル・リソース）/ V13（API）等を“クラウド構成差分”として検証する前提
  - この内容が支えるポイント：クラウドでの公開面/IAM/監査ログを固定し、管理策の成立条件を説明可能にする
- WSTG：
  - 該当カテゴリ/テスト観点：Config/Identity/API/Logging など、環境差が結論を左右する観点の前提
  - 該当が薄い場合：WSTGの各観点を“再現できる教材環境”として支える
- PTES：
  - 該当フェーズ：Pre-engagement（環境準備）/ Intelligence Gathering（公開面・境界把握）/ Vulnerability Analysis（差分解釈）を支える
  - 前後フェーズとの繋がり（1行）：クラウドの境界と証跡を固定することで、分析→検証→結論がブレない
- MITRE ATT&CK：
  - 該当戦術：Discovery / Credential Access / Collection（クラウドAPI・権限・ログの理解）
  - 攻撃者の目的：権限境界と公開面を把握し、次の手（横展開/データ到達）を選ぶための前提を掴む

## 参考（必要最小限）
- 04_labs/05_automation/01_iac_terraform_or_bicep.md
- 04_labs/01_local/03_capture_証跡取得（pcap/har/log）.md
- 01_topics/01_asm-osint/05_cloud_露出面（CDN/WAF/Storage等）推定.md

## リポジトリ内リンク（最大3つまで）
- 関連 labs：`04_labs/04_cloud/01_aws_lab_構成と検証観点.md`
- 関連 labs：`04_labs/04_cloud/02_azure_lab_構成と検証観点.md`
- 関連 labs：`04_labs/04_cloud/03_logging_クラウド監査ログの取り方.md`

---


<<<END>>>
