# 04_js_フロント由来の攻撃面抽出.md

## ガイドライン対応（ASVS / WSTG / PTES / MITRE ATT&CK：毎回）
- ASVS：フロント資産に現れる「外部依存」「設定」「秘密情報」「認可境界の手掛かり」を根拠付きで特定し、AuthN/AuthZ/API/Configの検証へ繋げる
- WSTG：Information Gathering を起点に、API/Authorization/Session/Configuration へ “入口と仮説” を供給する
- PTES：Intelligence Gathering（外形・依存・入口）→ Threat Modeling（境界）→ Vulnerability Analysis（優先度付け）へ直結
- MITRE ATT&CK：Reconnaissance / Discovery（公開資産から機能/API面を復元し、攻め筋の確率を上げる）

## 目的（この技術で到達する状態）
- JS（フロント資産）から、次を **観測根拠つきで** 作れる状態になる。
  - 入口（攻撃面）：APIエンドポイント、機能単位、管理系導線、外部連携（SaaS/解析/通知/Storage等）
  - 境界：資産境界（自社/第三者）、信頼境界（外部依存）、権限境界（ロール/テナント/管理系の手掛かり）
  - 優先度：AuthN/AuthZ/API/Input/Config のどこに寄せるべきか（仮説A/Bで分岐）
- “JSを眺めた”で終えず、**次の検証の打ち手（何を見て、何を試すか）** を確定する。

## 前提（対象・範囲・想定）
- 対象：許可されたスコープのWebアプリで配布されるJS/CSS/画像等の静的資産（CDN配信含む）
- 想定：
  - UIが薄くても、JSには API面・機能面・依存面が残る
  - 環境差分（prod/stg/dev）や残骸（移行前のAPI/旧ドメイン）が見えることがある
  - 断定はしない。**「根拠→状態→次の一手」** として扱う
- Labs連動（観測の標準化）：
  - `04_labs/01_local/02_proxy_計測・改変ポイント設計.md`（取得点の統一）
  - `04_labs/01_local/03_capture_証跡取得（pcap/har/log）.md`（証跡の最小セット）

## 観測ポイント（何を見ているか：プロトコル/データ/境界）
### 1) 資産境界（自社JS / 第三者JS）
- 観測対象
  - 自社配布のbundle（app.*.js 等）と第三者スクリプト（分析/広告/チャット等）の切り分け
- 見ている“境界”
  - 自社資産：設定/実装/認可の論点が乗る可能性が高い
  - 第三者資産：信頼境界（外部依存）として、設定・連携・データ流出の論点に繋がる

### 2) 入口（攻撃面：API/機能/管理）
- 観測対象（例）
  - APIベースURL（https://api.example / /api / graphql 等）
  - 機能を示す識別子（feature flags、route、画面名、権限名）
  - 管理/運用っぽい導線（admin, internal, console, debug 等の手掛かり）
- 見ている“境界”
  - 入口は “何を守るか（資産）” と “どこで権限が切り替わるか（権限境界）” を決める

### 3) 信頼境界（外部依存：SaaS/Storage/CDN/IdP）
- 観測対象（例）
  - 外部ドメイン（analytics, cdn, storage, webhook, error-reporting）
  - IdP/SSO連携の痕跡（issuer、client_id、redirect_uri のような構成要素の手掛かり）
- 見ている“境界”
  - 外部依存が強いほど、設定・連携・権限伝播（委任）の論点が増える

### 4) 権限境界（ロール/テナント/共有/委任の手掛かり）
- 観測対象（例）
  - role、permission、scope、tenant、org、project、owner、share の語彙
  - 管理系UIの分岐や、権限チェックの痕跡（例：403表示の条件、権限名）
- 見ている“境界”
  - 認可モデル（AuthZ）を作るための「境界変数」の候補

### 5) “秘密の兆候” と “実行境界の兆候”
- 観測対象（断定しない）
  - APIキー/トークンっぽい文字列、設定JSON、環境変数名、署名/暗号の手掛かり
  - テンプレ/式評価/デシリアライズ/動的import等、実行境界の匂い
- 見ている“境界”
  - 秘密情報：Config/Secrets（運用境界）
  - 実行境界：Input→Execution（入力がどこで解釈・実行され得るか）

## 結果の意味（その出力が示す状態：何が言える/言えない）
- 言えること（状態として）
  - 「このアプリは API中心か／画面中心か」
  - 「外部依存（信頼境界）がどこにあるか」
  - 「権限境界の変数候補（tenant/role/scope/owner）が何か」
  - 「環境差分/残骸の兆候があるか（優先度が上がる“理由”になる）」
- 言えないこと（断定しない）
  - JSに出たURLが必ず到達可能・スコープ内・脆弱という断定
  - 文字列が“本物の秘密”だという断定（兆候として扱い、次工程で観測確認する）

## 攻撃者視点での利用（意思決定：優先度・攻め筋・次の仮説）
- 目的は「列挙」ではなく「勝負所（境界が動く地点）」の特定
- 代表的な意思決定（例）
  - API面が厚い → `API（権限伝播）` を最優先に深掘り
  - role/tenant/scope が濃い → `AuthZ（境界モデル）` を最優先に深掘り
  - IdP/redirect/client の痕跡が濃い → `SaaS/IdP連携（信頼境界）` に寄せる
  - 外部Storage/共有の痕跡が濃い → `SaaS共有・外部連携` と `Config` に寄せる
  - 実行境界の兆候（テンプレ/式/動的評価）がある → `Input→実行境界` の仮説を立てる

## 次に試すこと（仮説A/Bの分岐と検証）
### 仮説A：API中心（UIは薄く、権限はAPIで決まる）
- 次の一手
  - `01_topics/02_web/04_api_権限伝播・入力・バックエンド連携.md`
  - `02_playbooks/05_api_権限伝播→検証観点チェック.md`
- 検証の観測点（最小）
  - 主要API 1〜3本を選び、主体差（ユーザーA/B）と所有差（自分/他人）で差分を取る

### 仮説B：AuthZ中心（role/tenant/owner の手掛かりが濃い）
- 次の一手
  - `01_topics/02_web/03_authz_認可（IDOR/BOLA/BFLA）境界モデル化.md`
  - `02_playbooks/04_authz_境界モデル→検証観点チェック.md`
- 検証の観測点（最小）
  - “境界変数” を1つだけ変えたときの拒否点（403/404/差分）を確認する

### 仮説C：IdP/委任中心（issuer/client/redirect/scope の兆候）
- 次の一手
  - `01_topics/04_saas/01_idp_連携（SAML/OIDC/OAuth）と信頼境界.md`
  - `01_topics/03_network/03_creds_認証情報の所在と扱い（攻撃/検知の両面）.md`
- 検証の観測点（最小）
  - 認証フローの遷移（リダイレクト連鎖）と、セッション材料（cookie/token）の所在を固める

### 仮説D：外部依存中心（CDN/WAF/Storage/外部APIが多い）
- 次の一手
  - `01_topics/01_asm-osint/05_cloud_露出面（CDN/WAF/Storage等）推定.md`（このフォルダ内の次）
  - `01_topics/02_web/06_config_設定・運用境界（CORS/ヘッダ/Secrets）.md`
- 検証の観測点（最小）
  - “どこが第三者か” を状態で確定し、責任分界と設定論点に落とす

## 例（最小：JSから攻撃面を抽出する時の観測の仕方）
~~~~
# 目的：ツール操作ではなく「何を抽出し、どう解釈し、次に何をするか」を固定する
#
# 抽出したいもの（例）
# - APIのベースURL / パス（/api, /graphql 等）
# - role/tenant/scope/owner 等の境界変数の手掛かり
# - 外部依存（第三者ドメイン）
# - 環境差分（prod/stg/dev）や旧ドメインの残骸
#
# 解釈（状態）
# - API中心 → APIプレイブックへ
# - 境界変数が濃い → AuthZモデル化へ
# - IdP/委任が濃い → SaaS/IdPへ
# - 外部依存が濃い → Cloud露出面/Configへ
~~~~

## ガイドライン対応（ASVS / WSTG / PTES / MITRE ATT&CK：毎回）
- ASVS：
  - 外部依存・設定・秘密情報・権限境界の手掛かりを、JSから根拠付きで抽出し、認証/認可/API/運用の検証を外さない
- WSTG：
  - Information Gathering の成果として、API/Authorization/Session/Configuration へ “入口と仮説” を供給する
- PTES：
  - Intelligence Gathering：JSから機能/API面と依存を復元
  - Threat Modeling：境界（資産/信頼/権限）を整理し、優先度へ反映
- MITRE ATT&CK：
  - Reconnaissance / Discovery：公開資産から攻撃面を復元し、攻め筋の確率を上げる（列挙より意思決定が主役）

## 参考（必要最小限）
- 接続先（Web/API/AuthZ/Config/SaaS）
  - `01_topics/02_web/03_authz_認可（IDOR/BOLA/BFLA）境界モデル化.md`
  - `01_topics/02_web/04_api_権限伝播・入力・バックエンド連携.md`
  - `01_topics/02_web/06_config_設定・運用境界（CORS/ヘッダ/Secrets）.md`
  - `01_topics/04_saas/01_idp_連携（SAML/OIDC/OAuth）と信頼境界.md`

