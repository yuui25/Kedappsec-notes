<<<BEGIN>>>
# 06_config_02_Secrets管理と漏えい経路（JS_ログ_設定_クラウド）.md

## ガイドライン対応（ASVS / WSTG / PTES / MITRE ATT&CK）
- ASVS：V7（エラー処理・ログ）/ V8（データ保護）/ V6（暗号・鍵管理の前提）/ V1（アーキテクチャ）へ接続。Secretsは“設定・運用境界”であり、実装不備だけでなく運用（配置/公開/記録）で漏れる。
- WSTG：設定レビュー・情報漏えい系の観点として、クライアント配布物（JS）/レスポンス/ログ/クラウド設定の漏えい経路を観測→差分で確定する。
- PTES：推測を排し、Evidence（どこで何が露出したか）を保存し、結論（露出あり/なし/不明）を説明可能にする。
- MITRE ATT&CK：Credential Access / Collection（例：Unsecured Credentials）に接続。Secrets露出は後続の到達性・権限・横展開の意思決定を短絡させる。

## 目的（この技術で到達する状態）
- “Secretsっぽい文字列”を見つけた段階で止まらず、**それが本当に秘密情報か／有効か／どこまで影響するか**を、観測→差分→結論で整理できる。
- 露出経路を「JS」「レスポンス」「ログ」「設定（クラウド/CI/CD）」に分解し、**再発防止に繋がる境界（どこで漏れたか）**を特定できる。
- 取り扱い（保存・共有・マスキング）を誤らず、ケースに **最小限の根拠**だけ残せる。

## 前提（対象・範囲・想定）
- 対象：APIキー、トークン、Cookie内トークン、接続文字列、秘密鍵、Webhook署名鍵、認証情報、内部URL、管理用IDなど。
- 観測点（固定）：
  - HTTP観測：`01_topics/01_asm-osint/03_http_観測（ヘッダ・挙動）と意味.md`
  - JS観測：`01_topics/01_asm-osint/04_js_フロント由来の攻撃面抽出.md`
  - クラウド露出推定：`01_topics/01_asm-osint/05_cloud_露出面（CDN_WAF_Storage等）推定.md`
  - 取得：`04_labs/01_local/02_proxy_計測・改変ポイント設計.md`
  - 証跡：`04_labs/01_local/03_capture_証跡取得（pcap_harl_log）.md`
- 重要な扱い：
  - Secretsは**取り扱い自体がリスク**。保存/共有は必ずマスクし、ケースは「場所・種類・根拠」中心にする。

## 観測ポイント（何を見ているか：漏えい経路の分解）
### 1) クライアント配布物（JS/ソースマップ/設定）
- 典型：
  - `app.js` / `config.js` に埋め込み
  - `*.map`（ソースマップ）に埋め込み
  - `window.__CONFIG__` のような初期設定JSONに埋め込み
- 見たいこと：
  - “秘密”がクライアントへ配布されていないか（配布＝境界崩壊）

### 2) HTTPレスポンス（ヘッダ/本文/エラー）
- 典型：
  - `Authorization` やカスタムヘッダの反射
  - デバッグレスポンスに設定値が載る
  - エラーに接続文字列・鍵の断片が含まれる
- 見たいこと：
  - どの条件（未認証/認証済/特定入力）で露出するか

### 3) ログ（サーバログ/監査ログ/アプリログ）
- 典型：
  - リクエストヘッダ/ボディを丸ごとログ（トークンが記録）
  - 例外ログに秘密値が混入
- 見たいこと：
  - “外部から見えない”前提でも、運用で漏えいし得る（内部流出・二次被害）

### 4) 設定・運用（クラウド/CI/CD/ストレージ公開）
- 典型：
  - 公開バケット、公開コンテナ、設定ファイルの露出
  - CIログや成果物に秘密値が混入
  - メタデータ/管理APIの露出（設定ミス）
- 見たいこと：
  - 露出が「アプリ」ではなく「基盤設定」由来か

## Secrets判定の型（意味→判断→次の一手）
### 1) “秘密”かどうかは、文字列ではなく「権限と用途」で決まる
- 意味：見た目がそれっぽくても、公開してよい識別子は存在する（公開キー/クライアントID等）。
- 判断：
  - その値で「何ができるか」を先に整理（認証、署名、管理操作、外部API実行など）
- 次の一手：
  - 値そのものはケースに残さず、**種類（例：外部APIキー相当）と露出場所**を記録する

### 2) 有効性（生きている/死んでいる）を推測で断言しない
- 意味：無効化済でも、運用的には“過去に漏れた”事実が問題になる場合がある。
- 判断：
  - “有効性不明”は unknown でよい（根拠が無いなら断言しない）
- 次の一手：
  - 取り得る最小の根拠（エラーメッセージ、権限不足レスポンス、監査ログ等）を揃えてから結論を出す

### 3) 露出経路の確定が最優先（再発防止に直結）
- 意味：同じ秘密値でも、漏れた経路で対策が変わる（JS埋め込み、ログ混入、設定公開）。
- 判断：
  - “どこで漏れたか”が確定できないと、対策が抽象論になりやすい
- 次の一手：
  - 「JS」「レスポンス」「ログ」「設定」のどれかに分類し、証跡（URL/レスポンス断片/ヘッダ名/時刻）を固定する

## 実務での結論の出し方（yes/no/unknown）
- yes（露出あり）
  - 外部から到達可能な場所（JS/レスポンス/公開ストレージ等）で、秘密情報“相当”が観測できる
- no（露出なし）
  - 想定経路を観測したが、秘密情報は確認できない（観測範囲を明記）
- unknown（不明）
  - 取得権限不足／ログ不足／条件再現不可／値の性質が判定できない
  - 次に必要な観測点（どのログ、どの設定、どの環境差分）が定義されていること

## 手を動かす検証（最小：観測→差分→記録）
~~~~
# 目的：Secrets露出を「場所の確定」と「条件の差分」で固める（値そのものは扱わない）

# 1) 露出場所の確定
# - JS：どのURL（.js / .map / 設定JSON）に含まれるか
# - レスポンス：どのエンドポイント/どの入力で含まれるか
# - ヘッダ：どのヘッダ名に現れるか
# - 設定：公開ストレージ/設定ファイルの到達性があるか

# 2) 条件差分（最小）
# - 未認証 vs 認証済（同一エンドポイント）
# - 入力なし vs 特定入力（エラー誘発等は“最小”の差分で）
# - 入口違い（CDN経由/直アクセス等）※環境がある場合のみ

# 3) 記録（ケースに残す最小情報）
# - 露出場所（URL/パス）
# - 種類（外部APIキー相当、接続文字列相当 等）
# - 露出条件（未認証で見える/特定操作後に見える 等）
# - 証跡リンク（Proxyログ/HAR/スクショ/ログ位置）
# - 結論（yes/no/unknown）
~~~~

## 結果の意味（その出力が示す状態：何が言える/言えない）
- 言えること（証跡で断定できる）
  - 露出の有無と露出経路（JS/レスポンス/設定など）
  - 露出条件（未認証で見える、特定操作で出る 等）
  - 影響の方向（読み取り可能性、外部連携悪用可能性の“入口”）
- 言えないこと（追加証跡が必要）
  - 実際の権限範囲（何ができるか）の確定（監査ログ/サービス側の権限情報が必要）
  - 値の有効性（失効済みか等）の確定（運用情報が必要）

## 次に試すこと（仮説A/Bの分岐と検証）
### 仮説A：JSにそれっぽい値がある
- 次に試すこと
  - その値が参照される箇所（どのAPI呼び出しに使われるか）を観測し、用途を推定ではなく“利用箇所”で裏付ける
- 期待する観測
  - “何のための値か”をケースに根拠付きで残せる（推測を減らす）

### 仮説B：エラーに設定値が混ざる
- 次に試すこと
  - 入力差分を最小にして再現性を確認し、エラー応答のどこに混入するかを確定する（同一条件で再現できないなら unknown）
- 期待する観測
  - 混入が条件依存であることを説明できる（再現性が根拠）

### 仮説C：公開ストレージ/設定公開が疑わしい
- 次に試すこと
  - “到達性（公開）”を事実として確定し、公開範囲（一覧可/取得可）を yes/no/unknown で整理する
- 期待する観測
  - アプリではなく基盤設定が境界であることを示せる

## 参考（必要最小限）
- 親：`01_topics/02_web/06_config_設定・運用境界（CORS ヘッダ Secrets）.md`
- 関連（JS）：`01_topics/01_asm-osint/04_js_フロント由来の攻撃面抽出.md`
- 関連（クラウド露出）：`01_topics/01_asm-osint/05_cloud_露出面（CDN_WAF_Storage等）推定.md`
- 観測：`04_labs/01_local/02_proxy_計測・改変ポイント設計.md`
- 証跡：`04_labs/01_local/03_capture_証跡取得（pcap_harl_log）.md`

## 深掘りリンク（親ファイル末尾に追加する枠：最大8件）
- （親）`01_topics/02_web/06_config_設定・運用境界（CORS ヘッダ Secrets）.md` の末尾に本ファイルへのリンクを追加する
  - `06_config_02_Secrets管理と漏えい経路（JS_ログ_設定_クラウド）.md`

---

<<<END>>>
