## ガイドライン対応（ASVS / WSTG / PTES / MITRE ATT&CK：毎回記載）
- ASVS
  - 破れる：デバッグ/管理/仕様公開が公開境界に露出すると、情報漏えい（内部構成/依存/エンドポイント）や不正操作（設定変更/ログ閲覧/ジョブ起動）が起こり得る。UIのみ認証でAPIが守られていないと権限境界が崩れる。
  - 満たす：管理面は公開境界から隔離（ネットワーク/別ドメイン/mTLS等）し、認可統一・監査ログ・例外統制で運用する。
- WSTG
  - 観点：管理/デバッグ/仕様公開エンドポイントの発見、認証・認可、返却情報の過多、直オリジン到達の有無を検証する。
- PTES
  - 位置づけ：情報収集（攻撃面抽出）→ 脆弱性分析（設定不備）→ 侵害評価（操作系の成立）→ 報告（隔離/統制の要求）。
- MITRE ATT&CK
  - Discovery（内部機能/構成の把握）に直結し、条件が揃うとT1190へ接続。操作系が露出する場合はImpactへ繋がり得る。

---

## タイトル
Debug Endpoints露出（/actuator / swagger等）：内部観測面が公開境界に出ると攻撃面が一気に具体化する

---

## 目的（このファイルで到達する状態）
- “見えるだけ”と“操作できる”を分け、**露出がどの境界を破るか**を判断できる。
- 実務で頻出の露出（Spring Actuator、Swagger/OpenAPI、GraphQL introspection等）を、観測→意味→次の一手で所見化できる。

---

## 扱う範囲（本ファイルの守備範囲）
- 露出の分類（情報/仕様/操作）
- 認証・認可の分断（UIだけ守る、APIだけ抜ける）
- 直オリジン/別ホスト/例外ルールでの露出（運用境界）
※製品手順や網羅列挙は目的にしない

---

## 前提：デバッグ面は“内部用の入口”なので、露出すると探索コストが激減する
### 現実で多い露出例（代表）
- Spring Boot Actuator：`/actuator/*`（health/info/metrics だけのつもりが env, heapdump 等が混ざる）
- Swagger/OpenAPI：`/swagger-ui` `/v3/api-docs` `/openapi.json`
- GraphQL：`/graphql` introspection
- Metrics：`/metrics` `/prometheus`
- 管理UI：`/admin` `/console`

---

## 境界モデル（露出が破る3つの境界）
- 信頼境界：内部用の観測情報が外部へ出る（内部URL/依存/環境名）
- 権限境界：操作系が露出すると“機能”として侵害になる（ログ閲覧/設定変更/ジョブ起動）
- 資産境界：CDN/WAFで閉じても、直オリジン・別ホストで残ると意味がない

---

## 露出の分類（診断で最初に分ける）
### 1) 情報露えい型（読むだけでも痛い）
- 依存ライブラリ/バージョン、ビルド情報、環境名、内部エンドポイント一覧、外部連携先の痕跡

### 2) 仕様公開型（攻撃面の地図を渡す）
- OpenAPI/Swagger：入力点、パラメータ、認証方式、管理APIの存在が見える
- GraphQL schema：型・フィールド・管理操作の入口が見える

### 3) 操作型（直接Impact）
- 設定変更、ログレベル変更、キャッシュクリア、ジョブ起動、シャットダウン等
※“可能かどうか”は認可とネットワーク境界で決まるため、観測で固める。

---

## 観測ポイント（現実で刺さる順）
- “同名の入口”が複数ある
  - Swagger UIは閉じているが、`/v3/api-docs` が匿名で返る
  - `health` はOKでも `env` / `heapdump` が残っている
- 直オリジン/別ホストの疑い
  - CDN経由では403だが、別サブドメイン/別IPで200
- 認可の責務分離が崩れている
  - UIはSSOで守るが、APIはトークン無しでも叩ける／ロール判定が欠落

---

## 結果の意味（この状態なら何が言えるか）
- 仕様公開が見える：攻撃面の探索コストが下がる（認可不備の発見確率が上がる）
- 情報露えいが濃い：内部構成・依存が推定でき、次の検証が具体化する
- 操作系が可能：設定不備が直接侵害経路になり得る（優先度を最大級に上げる）
- 403でも安心できない：別ホスト/直オリジン/例外ルールで残っている可能性がある

---

## 攻撃者視点での利用（現実でよくある使われ方）
- Swagger/OpenAPI → 管理APIや“想定外の機能”を最短で洗い出す
- Actuator/env/log/trace系 → 内部URL、秘密の痕跡、環境差を拾う
- health/metrics → 生存確認と構成推定（別ホスト発見の足掛かり）

---

## 次に試すこと（仮説A/Bで分岐）
### 仮説A：露出は“地図”としての価値（認可検証へ繋げる）
- 次の一手
  - 仕様公開から「管理/一般」「テナント境界」を抽出し、認可検証の優先度表を作る
  - “UIだけ守る”の分断を疑い、API単体での認可を観測する

### 仮説B：操作系が露出（直接侵害の可能性）
- 次の一手
  - 成立条件（認証要否、ロール、ネットワーク境界）を最小回数で確定し、影響半径を所見化
  - 対策は「消す」だけでなく、隔離（別ドメイン/VPN/mTLS）＋監査ログを要求する

---

## 修正（現実で通る要件）
- 本番は“公開境界に置かない”が原則（別ホスト・別ドメイン・ネットワーク隔離）
- 例外が必要なら（パートナー監視等）
  - IP制限だけに依存しない（直オリジン漏れを前提にする）
  - 認可統一（UI/APIで同じ権限境界）＋監査ログ必須

---

## 04_labs（露出の型を体感：情報/仕様/操作を分けて評価する）
- 追加候補Lab（例）
  - `04_labs/02_web/06_config/06_debug_endpoints_exposure/`
- Lab設計要件
  - Swagger/Actuator/GraphQLを意図的に混在し、UIとAPIで認可が分断されるケースも用意
  - 目的：露出の“型”で優先度と次の手を変えられること

---

## コマンド/例（例示は最小限：観測と判断を優先）
~~~~
# まずは分類：
# 1) 情報（読むだけ）
# 2) 仕様（攻撃面の地図）
# 3) 操作（状態変更）
# 次に境界：
# - CDN/WAF経由と直オリジン（可能なら）で差分
# - UIだけ認証/ APIは無認証 の分断がないか
~~~~

---

## 深掘りリンク（最大8）
- `06_config_10_cdn_waf_運用境界（ルール例外_バイパス）.md`
- `06_config_07_error_pages_詳細表示と環境切替.md`
- `06_config_08_logging_pii_secret（マスキング_相関）.md`
- `06_config_03_security_headers（CSP_HSTS_XFO等）.md`
- `02_playbooks/02_web_recon_入口→境界→検証方針.md`
- `05_input_19_cache_poisoning_02_unkeyed（headers_params）.md`
- `05_input_20_crlf_injection_02_downstream（proxy_log_cache）.md`
- `05_input_10_open_redirect（遷移先信頼境界）.md`
